"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1217],{66605:function(e,t,n){n.d(t,{P9:function(){return v},Vw:function(){return p},aP:function(){return f},cE:function(){return m},fg:function(){return y},us:function(){return g}});var r=n(5362),i=n(27218),a=n(6385),o=n(13262),l=n(10228),u=n(77930),c=n(7653),s=n(19132),d=n(22534);let f=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,a=!!(t&&e.length>0),l=(0,c.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),u=(0,c.useMemo)(()=>({queryKey:e.map(e=>[o.cF,{orgUuid:n,syncSourceUuid:e}]),enabled:a,refetchInterval:e=>!!(e.state.data&&(0,s.sf)(e.state.data))&&5e3,meta:{noToast:!0}}),[a,n,e]);return(0,r.Nl)(l,u)},p=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,s.sf)(e.data)),y=e=>Math.ceil(f(e).reduce((e,t)=>{var n,r,i;return t.isLoading||!t.data?e:e+(null!==(i=null===(r=t.data)||void 0===r?void 0:null===(n=r.status)||void 0===n?void 0:n.current_size_bytes)&&void 0!==i?i:0)},0)/a.r6),m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,i.t)(),a=null==t?void 0:t.uuid,c=null==n?void 0:n.uuid,f=(0,u.useQueryClient)(),p=(0,s.gb)();return(0,r.uC)(()=>"/api/organizations/".concat(c,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,r,i,u,s=arguments.length,d=Array(s),p=0;p<s;p++)d[p]=arguments[p];let[y]=d;f.setQueryData([o.cF,{orgUuid:c,syncSourceUuid:y.uuid}],y),y.type===l.Fg.GDRIVE&&y.config.uri&&(null===(t=y.status)||void 0===t?void 0:t.extra)&&(null===(n=y.status)||void 0===n?void 0:n.current_size_bytes)&&f.setQueryData([o.HI,{accountUUID:a,orgUUID:c,documentId:y.config.uri}],{uri:"drive:///".concat(y.config.uri),title:null===(i=y.status)||void 0===i?void 0:i.extra,size:null===(u=y.status)||void 0===u?void 0:u.current_size_bytes}),null===(r=e.onSuccess)||void 0===r||r.call(e,...d)},onError:function(){for(var t,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];null===(t=e.onError)||void 0===t||t.call(e,...r);let[a,o]=r;p(a,o),o.sync_source_type===l.Fg.GDRIVE&&(0,d.ZZ)(o.sync_source_config.uri)}})},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,a=(0,u.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,r=arguments.length,i=Array(r),l=0;l<r;l++)i[l]=arguments[l];let[u]=i;a.setQueryData([o.cF,{orgUuid:n,syncSourceUuid:u.uuid}],u),null===(t=e.onSuccess)||void 0===t||t.call(e,...i)}})},g=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid;return(0,r.uC)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},18187:function(e,t,n){n.d(t,{HN:function(){return u},SE:function(){return c},Tx:function(){return s}});var r=n(5362),i=n(27218),a=n(13262),o=n(77930),l=n(32559);let u=(e,t)=>{let{account:n,activeOrganization:u}=(0,i.t)(),c=t===(null==n?void 0:n.uuid),s=null==u?void 0:u.uuid,d=(0,o.useQueryClient)(),f=(0,l.Gm)();return(0,r.uC)(()=>"/api/organizations/".concat(s,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{d.invalidateQueries({queryKey:[a.l3,{projectUuid:e}]}),c&&(f(e),d.invalidateQueries({queryKey:[a.VH,{orgUUID:s}]}),d.invalidateQueries({queryKey:[a.tv,{orgUUID:s}]}),d.invalidateQueries({queryKey:[a.Dn,{orgUUID:s}]}))}})},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.t)(),o=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(o,"/projects/").concat(e,"/accounts"),{queryKey:[a.l3,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0})},s=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,l=(0,o.useQueryClient)();return(0,r.uC)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[a.l3,{projectUuid:e}]})},transformVariables:e=>({role:e.role})})}},95899:function(e,t,n){n.d(t,{ER:function(){return f},Kf:function(){return c},Zy:function(){return y},h4:function(){return m},i9:function(){return u},op:function(){return p},pK:function(){return v},tR:function(){return s},u3:function(){return d}});var r=n(5362),i=n(27218),a=n(30947),o=n(13262),l=n(77930);let u="[ANT ONLY] synced_resources.txt";function c(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.t)(),a=null==n?void 0:n.uuid,{data:l,...c}=(0,r.WE)("/api/organizations/".concat(a,"/projects/").concat(e,"/docs"),{queryKey:[o.zy,{orgUuid:a,projectUuid:e}],enabled:!!n&&!!e&&t});return{data:null==l?void 0:l.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0}).filter(e=>{let{file_name:t}=e;return t!==u}),unfilteredData:l,...c}}let s=e=>{let{projectUuid:t,docUuid:n}=e,{activeOrganization:l}=(0,i.t)(),u=null==l?void 0:l.uuid;return(0,r.WE)("/api/organizations/".concat(u,"/projects/").concat(t,"/docs/").concat(n),{queryKey:[o.tt,{orgUuid:u,projectUuid:t,docUuid:n}],enabled:!!l,staleTime:0,meta:{noToast:e=>e instanceof a.Hx&&404===e.statusCode}})};function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,i.t)(),a=null==n?void 0:n.uuid,u=(0,l.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/docs"),"POST",{enabled:!!e,onSuccess:function(){for(var n,r=arguments.length,i=Array(r),l=0;l<r;l++)i[l]=arguments[l];u.invalidateQueries({queryKey:[o.zy,{orgUuid:a,projectUuid:e}]}),u.invalidateQueries({queryKey:[o.VH,{orgUUID:a}]}),u.invalidateQueries({queryKey:[o.rt,{orgUuid:a,projectUuid:e}]}),null===(n=t.onSuccess)||void 0===n||n.call(t,...i)},onError:function(){for(var e,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];null===(e=t.onError)||void 0===e||e.call(t,...r)}})}function f(e){let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,a=(0,l.useQueryClient)();return(0,r.Ne)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e.docUuid):t,{queryKey:[o.zy,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,r)=>{a.invalidateQueries({queryKey:[o.tt,{orgUuid:n,projectUuid:e,docUuid:r.docUuid}]}),a.invalidateQueries({queryKey:[o.zy,{orgUuid:n,projectUuid:e}]}),a.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]}),a.invalidateQueries({queryKey:[o.rt,{orgUuid:n,projectUuid:e}]})}})}let p=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,a=(0,l.useQueryClient)();return(0,r.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.doc_uuids.includes(t.uuid)):t,{queryKey:[o.zy,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,r)=>{for(let t of r.doc_uuids)a.invalidateQueries({queryKey:[o.tt,{orgUuid:n,projectUuid:e,docUuid:t}]});a.invalidateQueries({queryKey:[o.zy,{orgUuid:n,projectUuid:e}]}),a.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]}),a.invalidateQueries({queryKey:[o.rt,{orgUuid:n,projectUuid:e}]})}})};function y(e){let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,a=(0,l.useQueryClient)();return(0,r.Ne)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"PUT",(e,t)=>t?t.map(t=>t.uuid===e.docUuid?{...t,...e}:t):t,{queryKey:[o.zy,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,r)=>{a.invalidateQueries({queryKey:[o.tt,{orgUuid:n,projectUuid:e,docUuid:r.docUuid}]}),a.invalidateQueries({queryKey:[o.zy,{orgUuid:n,projectUuid:e}]}),a.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]})}})}function m(e){let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,a=(0,l.useQueryClient)();return(0,r.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/files/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.file_uuids.includes(t.file_uuid)):t,{queryKey:[o.jb,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:()=>{a.invalidateQueries({queryKey:[o.jb,{orgUuid:n,projectUuid:e}]}),a.invalidateQueries({queryKey:[o.VH,{orgUUID:n}]}),a.invalidateQueries({queryKey:[o.rt,{orgUuid:n,projectUuid:e}]})}})}function v(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.t)(),a=null==n?void 0:n.uuid;return(0,r.WE)("/api/organizations/".concat(a,"/projects/").concat(e,"/files"),{queryKey:[o.jb,{orgUuid:a,projectUuid:e}],enabled:!!n&&!!e&&t})}},92676:function(e,t,n){n.d(t,{AQ:function(){return y},IP:function(){return d},gr:function(){return u},l2:function(){return c},yg:function(){return f},zB:function(){return s}});var r=n(5362),i=n(27218),a=n(13262),o=n(77930),l=n(19132);let u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,i.t)(),a=null==n?void 0:n.uuid,o=p(),u=(0,l.gb)();return(0,r.uC)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];o(e),null===(n=t.onSuccess)||void 0===n||n.call(t,...i)},onError:function(){for(var e,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];null===(e=t.onError)||void 0===e||e.call(t,...r);let[a,o]=r;u(a,o)}})},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,i.t)(),a=null==n?void 0:n.uuid,o=p();return(0,r.uC)(()=>"/api/organizations/".concat(a,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];o(e),null===(n=t.onSuccess)||void 0===n||n.call(t,...i)}})},s=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,o=p();return(0,r.Ne)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[a.AI,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},d=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,o=p();return(0,r.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[a.AI,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},f=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:o}=(0,i.t)(),u=null==o?void 0:o.uuid,c=!!(o&&e&&n),{data:s,isLoading:d}=(0,r.WE)("/api/organizations/".concat(u,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[a.AI,{orgUuid:u,projectUuid:e,calculateSize:t}],enabled:c,refetchInterval:e=>{var t;return(null===(t=e.state.data)||void 0===t?void 0:t.some(l.sf))?5e3:3e5}});return{data:s,isLoading:!!c&&d}},p=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[a.AI,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[a.Xg,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[a.rt,{orgUuid:t,projectUuid:e}]})}},y=e=>{let{data:t}=f(e);return!!(null==t?void 0:t.some(l.sf))}},32559:function(e,t,n){n.d(t,{GO:function(){return C},Gm:function(){return T},Kn:function(){return j},O3:function(){return w},Qs:function(){return S},RN:function(){return b},VR:function(){return h},YJ:function(){return g},Yc:function(){return x},cd:function(){return i},dY:function(){return E},iR:function(){return U},nL:function(){return a},oS:function(){return v}});var r,i,a,o=n(28803),l=n(5362),u=n(27218),c=n(30947),s=n(13262),d=n(77930),f=n(21520),p=n.n(f),y=n(7653),m=n(95586);let v=30,g=1e4;(i||(i={})).Student="student",(r=a||(a={})).Study="study",r.Career="career",r.Research="research";let h=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid;return(0,l.WE)("/api/organizations/".concat(t,"/projects/count"),{queryKey:[s.bZ,{orgUUID:t}],staleTime:3e5,enabled:!!t})},w=e=>{let{enabled:t=!0,limit:n,offset:r,starred:i,creatorFilter:a}=e,{activeOrganization:o}=(0,u.t)(),c=(0,m.U)(),d=null==o?void 0:o.uuid,f=new URLSearchParams;return f.append("include_harmony_projects","true"),void 0!==n&&f.append("limit",n.toString()),void 0!==r&&f.append("offset",r.toString()),void 0!==i&&f.append("starred",i.toString()),void 0!==a&&f.append("creator_filter",a.toString()),(0,l.WE)("/api/organizations/".concat(d,"/projects?").concat(f.toString()),{queryKey:[s.gi,{orgUuid:d},{limit:n,offset:r,starred:i,creatorFilter:a}],enabled:!!(t&&o&&c),select:e=>e.filter(e=>!e.archived_at)})},b=()=>{let{activeOrganization:e}=(0,u.t)(),t=(0,l.OJ)();return(0,y.useCallback)(async()=>(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/projects"))).json(),[null==e?void 0:e.uuid,t])},_=(e,t)=>{let n=e.map(e=>({...e,lastConversation:null==t?void 0:t.find(t=>t.project_uuid===e.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),r=null==e?void 0:e.filter(e=>!n.find(t=>t.uuid===e.uuid));return[...n,...r]},C=()=>{let e=b(),t=(0,o.Pe)();return(0,y.useCallback)(async()=>{let[n,r]=await Promise.all([e(),t({limit:o.bf})]);return _(n,r)},[t,e])},x=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid;return(0,l.WE)("/api/organizations/".concat(n,"/projects/").concat(e),{queryKey:[s.$T,{orgUuid:n,projectUuid:e}],enabled:!!(t&&e),staleTime:0,meta:{noToast:e=>e instanceof c.Hx&&404===e.statusCode}})},S=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return(0,l.uC)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[s.gi,{orgUuid:t}]})}})},E=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid,r=T();return(0,l.Ne)(()=>"/api/organizations/".concat(n,"/projects/").concat(e),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{r(e)},queryKey:[s.$T,{orgUuid:n,projectUuid:e}]})},U=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid;return(0,l.WE)("/api/organizations/".concat(n,"/projects/").concat(e,"/conversations"),{queryKey:[s.lx,{orgUuid:n,projectUuid:e}],enabled:!!t,staleTime:0,select:e=>p()(e,e=>new Date(e.updated_at)).reverse()})},j=()=>{var e,t;let n=w({enabled:!0,creatorFilter:"is_creator",limit:g}),r=null===(t=n.data)||void 0===t?void 0:null===(e=t.find(e=>e.is_starter_project))||void 0===e?void 0:e.uuid;return{...n,data:r}},T=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid,n=(0,d.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[s.$T,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[s.gi,{orgUuid:t}]}),n.invalidateQueries({queryKey:[s.lx,{orgUuid:t,projectUuid:e}]})}}},42814:function(e,t,n){n.d(t,{GB:function(){return u},HK:function(){return d},KM:function(){return s},fq:function(){return c},h9:function(){return l}});var r=n(5362),i=n(27218),a=n(13262),o=n(77930);let l=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid;return(0,r.WE)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[a.it,{orgUUID:t}]})},u=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[a.it,{orgUUID:t}]})}})},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,i.t)(),l=null==n?void 0:n.uuid,u=(0,o.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(l,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{u.invalidateQueries({queryKey:[a.it,{orgUUID:l}]})},enabled:!t})},s=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,l=(0,o.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{l.invalidateQueries({queryKey:[a.it,{orgUUID:n}]})}})},d=()=>{let{activeOrganization:e}=(0,i.t)(),t=null==e?void 0:e.uuid;return(0,r.uC)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},95586:function(e,t,n){n.d(t,{H:function(){return o},U:function(){return a}});var r=n(27218),i=n(58183);let a=()=>{let e=(0,r.ZJ)(),t=(0,r.ue)(),n=(0,r.Cf)();return(0,i.useDynamicConfig)("claude_ai_projects_limits").get("max_free_projects",0)>0||n||e||t},o=()=>{let e=(0,r.ZJ)(),t=(0,r.ue)(),n=(0,r.Cf)(),a=(0,i.useDynamicConfig)("claude_ai_projects_limits");if(!e&&!n&&!t)return a.get("max_free_projects",0)}},91217:function(e,t,n){n.d(t,{x:function(){return E},r:function(){return S}});var r=n(27573),i=n(26525),a=n(5161),o=n(64295),l=n(6766),u=n(5362),c=n(7653),s=n(66605),d=n(95899),f=n(92676),p=n(40051),y=n(7680),m=n(18701),v=n(40030),g=n(10690),h=n(18013),w=n(70773);let b={type:"doc",content:[{type:"paragraph",content:[]}]},_=e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")),C=e=>{let t=(0,c.useCallback)(t=>{if(!(!e||_(document.activeElement))&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;t.preventDefault(),null===(n=e.getEditor())||void 0===n||n.chain().insertContent(t.key).focus().run()}},[e]);(0,c.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])},x=c.createContext({attachments:[],files:[],transitionFiles:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",tipTapEditorState:{},projectUuid:void 0,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setTipTapEditorState:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,isFocused:!1,setIsFocused:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,isPromptUnsafe:()=>!1,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0}),S=()=>c.useContext(x),E=e=>{var t,n,_,S,E,U,j;let{onSend:T,willRedirectOnSubmit:z,onCreate:k,onStopSampling:P,customFileUploadHandler:I}=e,D=(0,c.useRef)(null),A="conversation"in e,{children:M,projectUuid:F,namespace:q}=e,K=A?e.conversation:void 0,R=(0,c.useCallback)(()=>{A&&P&&P()},[P,A]);C(D.current);let{tipTapEditorState:Q,setTipTapEditorText:L,setTipTapEditorJSON:O,isTipTapEditorStateUnsafe:N,attachments:H,setAttachments:Z,files:W,setFiles:Y,syncSourceUuids:B,setSyncSourceUuids:J,clear:V}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r="".concat(n?"".concat(n,":"):"").concat(e),[i,a,l]=(0,h.R)("".concat(r,":attachment"),[]),[u,s,d]=(0,h.R)("".concat(r,":files"),[]),[f,p,y]=(0,h.R)("".concat(r,":syncSourceUuids"),[]),[m,v,g]=(0,h.R)("".concat(r,":textInput"),t?{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:t}]}]}:b),_=(0,c.useCallback)(()=>!!m.__ant_unsafe,[m]),C=(0,c.useCallback)((e,t)=>{let n=(0,w.G)(e),r={type:"doc",content:[{type:"paragraph",content:[{type:"text",text:n}]}]};return n.length>0&&t&&(r.__ant_unsafe=!0),v(r),n},[v]);return{attachments:i,setAttachments:a,files:u,setFiles:s,syncSourceUuids:f,setSyncSourceUuids:p,tipTapEditorState:m,setTipTapEditorJSON:(0,c.useCallback)(e=>{let t=(0,o.A5)(e);return t.length>0&&_()&&(e.__ant_unsafe=!0),v(e),t},[v,_]),setTipTapEditorText:C,isTipTapEditorStateUnsafe:_,clear:(0,c.useCallback)(()=>{g(),l(),d(),y()},[l,g,d,y])}}(null!==(n=null==K?void 0:K.id)&&void 0!==n?n:void 0===F?"new-conversation":"".concat(F,":conversation"),"",q),G=Q?(0,o.A5)(Q):"",[X,$]=c.useState(G),ee=(0,c.useCallback)(e=>{$(O(e))},[O,$]),et=(0,c.useCallback)(function(e){let{forceUpdateTiptap:t=!0,unsafe:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=L(e,n);if($(r),!0===t){var i;null===(i=D.current)||void 0===i||i.setContent(r)}},[L]),en=(0,s.aP)(B),er=(0,s.Vw)(en),ei=(0,u.F9)(en),ea=H.length+W.length+B.length>=i.Qe,[eo,el]=c.useState(!1),[eu,ec]=c.useState(),{stickyModelPreference:es}=(0,l.M)(),ed=null!==(E=null!==(S=null!==(_=null==K?void 0:K.model)&&void 0!==_?_:eu)&&void 0!==S?S:es)&&void 0!==E?E:void 0,[ef,ep]=c.useState(),ey=(0,c.useCallback)(e=>{ep(t=>({...t,...e}))},[]),[em,ev]=c.useState(F),eg=(0,f.AQ)(em),[eh,ew]=c.useState(!1),[eb,e_]=c.useState(),[eC,ex]=c.useState(!1),[eS,eE]=c.useState(!1),[eU,ej]=c.useState(!1),{storedStyle:eT,defaultStyle:ez}=(0,p.O)(),[ek,eP]=c.useState(),[eI,eD]=c.useState(!0),[eA,eM]=c.useState();(0,c.useEffect)(()=>{let e=null!=eT?eT:ez;!ek&&e&&eP(e)},[eT,ez,ek]),(0,c.useEffect)(()=>{F&&em!==F&&ev(F)},[F,em]);let eF="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,c.useEffect)(()=>{e_(void 0),ew(!1)},[null==K?void 0:K.id]),(0,c.useEffect)(()=>{null==eF||eF(ek)},[ek,eF]);let{projectHasHarmony:eq}=(0,m.Y)(em),{openedFiles:eK,projectDocs:eR,projectUuid:eQ}=(0,v.b)(),{getInstance:eL}=(0,y.s)(),{mutateAsync:eO}=(0,d.u3)(eQ),{mutateAsync:eN}=(0,d.Zy)(eQ),eH=(0,c.useCallback)(async()=>{if(D.current&&(""!==X.trim()||0!==H.length||0!==W.length||0!==B.length)){z&&e_([...W]),V(),$(""),z?D.current.setEditable(!1):D.current.setContent(""),ew(!0),eq&&await (null===g.ec||void 0===g.ec?void 0:(0,g.ec)(eK,eQ,eR,eO,eN,eL));try{A&&T?(await T({prompt:X,attachments:H,files:W,syncSources:ei,personalized_style:ek}),ew(!1),e_(void 0)):await k({prompt:X,attachments:H,files:W,syncSources:ei,model:ed,project_uuid:em,personalized_style:ek,include_conversation_preferences:eI,...ef})}catch(t){var e;et(X),null===(e=D.current)||void 0===e||e.setContent(X),Z(H),Y(W),J(B),D.current.setEditable(!0),ew(!1),e_(void 0)}}},[ef,H,V,eO,W,eL,eQ,eq,eI,A,ed,k,T,eK,ek,eR,em,X,Z,Y,et,J,B,ei,eN,z]),eZ=(0,c.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&A){ew(!0);try{T&&(await T({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:ek}),ew(!1))}catch(e){ew(!1)}}},[A,T,ek]),eW=(0,c.useCallback)(async e=>{if(ec(e),A){ew(!0);try{var t;await k({prompt:X,attachments:H,files:W,syncSources:ei,model:e,project_uuid:em,create_mode:null==K?void 0:null===(t=K.conversationSettings)||void 0===t?void 0:t.create_mode,...ef})}finally{ew(!1)}}},[ef,H,W,A,em,X,k,ei,null==K?void 0:null===(t=K.conversationSettings)||void 0===t?void 0:t.create_mode]),eY=(0,c.useCallback)(()=>{var e;return null===(e=D.current)||void 0===e?void 0:e.focus()},[D]),[eB,eJ]=c.useState(!1),eV=(0,a.eh)(),[eG,eX,e$,e0,e1,e2,e3,e5]=(0,i.kS)({syncSourceCount:B.length,attachments:H,setAttachments:Z,numExistingConversationAttachments:null!==(U=null==K?void 0:K.attachmentsSoFar)&&void 0!==U?U:0,files:W,setFiles:Y,numExistingConversationFiles:null!==(j=null==K?void 0:K.files.length)&&void 0!==j?j:0,detectSameAttachment:()=>!1,selectedModel:ed,blobFileUploadsEnabled:eV,customFileUploadHandler:I}),e7=H.length+W.length,e8=B.length,e6=eG||eS||eU,e9=e7>0||e8>0||e6,e4=(0,c.useMemo)(()=>{var t;return{prompt:X,tipTapEditorState:Q,attachments:H,files:e.willRedirectOnSubmit&&eh?null!=eb?eb:[]:W,syncSourceUuids:B,isAtMaxNumUploads:ea,isUploadingDriveSync:eS,isUploadingGithubSync:eU,model:ed,projectUuid:em,isChatSyncing:er,personalizedStyle:ek,isProjectSyncing:eg,isNewConversation:void 0===K||0===K.messagesSoFar,isProjectLocked:void 0!==F||void 0!==K,isSending:eh,setPrompt:et,setTipTapEditorState:ee,setAttachments:Z,setFiles:Y,setSyncSourceUuids:J,setModel:eW,setProjectUuid:ev,sendMessage:eH,sendTransparentMessage:eZ,stopSampling:R,conversation:K,focusInput:eY,isFocused:eC,setIsFocused:ex,promptInputRef:D,willRedirectOnSubmit:null!==(t=e.willRedirectOnSubmit)&&void 0!==t&&t,hasBlockingWarning:eB,setHasBlockingWarning:eJ,setPersonalizedStyle:eP,setIsUploadingDriveSync:eE,setIsUploadingGithubSync:ej,includeProfilePreferences:eI,setIncludeProfilePreferences:eD,pendingConversationSettings:ef,setPendingConversationSettings:ey,isUploadingFile:eG,setIsUploadingFile:eX,validateMaxUploadLimit:e$,onDrop:e0,onPasteFiles:e1,handleUpload:e2,uploadInputProps:e5,hasAttachments:e9,isModelSelectorOpen:eo,setIsModelSelectorOpen:el,isPromptUnsafe:N,currentCompassTask:eA,setCurrentCompassTask:eM}},[H,K,W,eY,F,eB,eI,ea,er,eC,eg,eh,eS,eU,ed,ek,em,X,e.willRedirectOnSubmit,eH,eZ,Z,Y,eW,ef,ey,et,J,ee,R,B,Q,eb,eG,eX,e$,e0,e1,e2,e5,e9,eo,el,N,eA,eM]);return(0,r.jsx)(x.Provider,{value:e4,children:M})}},47082:function(e,t,n){n.d(t,{M:function(){return d},Y:function(){return f}});var r=n(27573),i=n(35919),a=n.n(i),o=n(7653);function l(e,t){switch(t.type){case"OPEN_COMPASS_STATUS":return{...e,selectedItem:{type:"compass",data:t.data}};case"SELECT_ATTACHMENT":return{...e,selectedItem:{type:"attachment",attachment:t.attachment}};case"SELECT_ARTIFACT":return{...e,selectedItem:{type:"artifact",id:t.id,versionUUID:t.versionUUID}};case"SELECT_DOC":return{...e,selectedItem:{type:"doc",id:t.id}};case"SELECT_SYNCED_DIRECTORY":return{...e,selectedItem:{type:"syncedDirectory",id:t.id}};case"CLEAR_SELECTED":return{...e,selectedItem:null,activeMessageUUID:void 0};case"SET_ACTIVE_MESSAGE_UUID":return{...e,activeMessageUUID:t.uuid};case"UPDATE_ARTIFACTS":return{...e,artifacts:t.artifacts};case"UPDATE_ATTACHMENTS":return{...e,attachments:t.attachments};case"UPDATE_FILES":return{...e,files:t.files};case"UPDATE_SYNC_SOURCES":return{...e,syncSources:t.syncSources};case"UPDATE_DOC_UPDATES":return{...e,docUpdates:t.updates};case"UPDATE_FILE_EDITS":return{...e,fileEdits:t.edits};default:return e}}let u={selectedItem:null,artifacts:{},attachments:[],files:[],syncSources:[],docUpdates:[],fileEdits:new Map,activeMessageUUID:void 0,conversationUUID:void 0},c={chatResourceState:u,dispatchChatResource:a()},s=(0,o.createContext)(c);function d(e){let{children:t,conversationUUID:n}=e,[i,a]=(0,o.useReducer)(l,{...u,conversationUUID:n});return(0,r.jsx)(s.Provider,{value:{chatResourceState:i,dispatchChatResource:a},children:t})}function f(){return(0,o.useContext)(s)}},40051:function(e,t,n){n.d(t,{O:function(){return l}});var r=n(18013),i=n(87033),a=n(42814);let o=(e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t,l=()=>{let{value:e}=(0,i.FL)("concise_mode_enabled"),{data:t,isLoading:n}=(0,a.h9)(),l=(null==t?void 0:t.defaultStyles)||[],u=[...l,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[c,s,d]=(0,r.R)("claude_personalized_style",null);if(n||!(null==u?void 0:u.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:s,clearStoredStyle:d,conciseModeEnabled:e};let f=l.length?l.find(e=>!0===e.isDefault)||l[0]:null;if(e&&(f=l.find(e=>"Concise"===e.key)||f),!c)return{personalizedStyleOptions:u,defaultStyle:f,storedStyle:c,setStoredStyle:s,clearStoredStyle:d,conciseModeEnabled:e};let p=u.find(e=>o(e,c.styleKey)),y=Date.now()-new Date(c.timestamp).getTime()>432e5;return{personalizedStyleOptions:u,storedStyle:p&&!y?p:null,defaultStyle:f,setStoredStyle:s,clearStoredStyle:d,conciseModeEnabled:e}}},22534:function(e,t,n){n.d(t,{F7:function(){return o},MU:function(){return a},ZZ:function(){return l}});let r="recentDriveDocs";function i(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function a(e){localStorage.setItem(r,JSON.stringify(e))}function o(){let e=localStorage.getItem(r);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(i))return t}return[]}function l(e){let t=o();a(t=t.filter(t=>t.uri!==e))}},7680:function(e,t,n){n.d(t,{r:function(){return g},s:function(){return h}});var r=n(27573),i=n(3053),a=n(80762),o=n(28346),l=n(24558),u=n.n(l),c=n(35919),s=n.n(c),d=n(7653),f=n(47082),p=n(40030);let y=(0,d.createContext)(null),m={getInstance:()=>void 0,setBaseContent:s(),flagForDeletion:s(),getCurrentContent:()=>void 0,hasUnsavedChanges:()=>!1,registerEditor:s(),unregisterEditor:s(),setMergeState:()=>s(),subscribeToMergeStateChanges:()=>s(),acceptAllChanges:s(),rejectAllChanges:s(),deactivateChangesMode:s(),activeEditors:[],changesMode:!1},v=(e,t)=>{var n,r;let i=null===(r=(0,o.Sk)(e.state))||void 0===r?void 0:null===(n=r.chunks)||void 0===n?void 0:n[0];return!!i&&("accept"===t?o.bN:o.A)(e,i.fromB)};function g(e){let{children:t}=e,{track:n}=(0,i.z$)(),{openedFiles:o}=(0,p.b)(),{dispatchChatResource:l}=(0,f.Y)(),c=(0,d.useRef)(new Map),s=(0,d.useRef)(new Set),m=(0,d.useCallback)((e,t)=>{c.current.set(e,{view:t})},[]),g=(0,d.useCallback)(e=>{c.current.delete(e)},[]),h=(0,d.useCallback)((e,t)=>{let n=c.current.get(e);if(!n){a.v("Attempted to update unknown editor: ".concat(e));return}c.current.set(e,{...n,...t})},[]),w=(0,d.useCallback)((e,t)=>h(e,{baseContent:t}),[h]),b=(0,d.useCallback)(e=>h(e,{filePendingDeletion:!0}),[h]),_=(0,d.useCallback)((e,t)=>{h(e,{mergeState:t}),s.current.forEach(n=>n(e,t))},[h]),C=(0,d.useCallback)(e=>(s.current.add(e),()=>{s.current.delete(e)}),[]),x=(0,d.useCallback)(e=>c.current.get(e),[]),[S,E]=(0,d.useState)([]),[U,j]=(0,d.useState)(!1),T=(0,d.useCallback)(()=>{l({type:"UPDATE_FILE_EDITS",edits:new Map}),j(!1)},[l]);(0,d.useEffect)(()=>{S.length&&j(!0)},[S]),(0,d.useEffect)(()=>(E(o.filter(e=>{var t;let n=x(e);return!!n&&(null===(t=n.mergeState)||void 0===t?void 0:t.isActive)&&!!n.view})),C((e,t)=>{E(n=>{var r;let i=n.includes(e),a=t.isActive&&!!(null===(r=x(e))||void 0===r?void 0:r.view);return i===a?n:a?[...n,e]:n.filter(t=>t!==e)})})),[o,C,x,U]);let z=(0,d.useCallback)(()=>{S.forEach(e=>{var t;let n=null===(t=x(e))||void 0===t?void 0:t.view;if(n)for(;v(n,"accept"););}),n({event_key:"harmony.suggestion.accepted"})},[S,n,x]),k=(0,d.useCallback)(()=>{S.forEach(e=>{var t;let r=null===(t=x(e))||void 0===t?void 0:t.view;if(r){for(;v(r,"reject"););_(e,{isActive:!1}),n({event_key:"harmony.suggestion.rejected"})}})},[S,n,x,_]),P=(0,d.useCallback)(e=>{var t,n;return null===(n=x(e))||void 0===n?void 0:null===(t=n.view)||void 0===t?void 0:t.state.doc.toString()},[x]),I=(0,d.useCallback)(e=>{var t;let n=P(e);return u()(n)&&n!==(null===(t=x(e))||void 0===t?void 0:t.baseContent)},[P,x]),D=(0,d.useMemo)(()=>({getInstance:x,setBaseContent:w,flagForDeletion:b,getCurrentContent:P,hasUnsavedChanges:I,registerEditor:m,unregisterEditor:g,setMergeState:_,subscribeToMergeStateChanges:C,acceptAllChanges:z,rejectAllChanges:k,deactivateChangesMode:T,activeEditors:S,changesMode:U}),[x,w,b,P,I,m,g,_,C,z,k,T,S,U]);return(0,r.jsx)(y.Provider,{value:D,children:t})}function h(){return(0,d.useContext)(y)||m}},71844:function(e,t,n){n.d(t,{KA:function(){return c},Nc:function(){return u},YB:function(){return l},b8:function(){return a},h4:function(){return o}});var r=n(39160),i=n.n(r);function a(e,t){return i()(e,t)}function o(e){let t=[],n=0;for(let[r,i]of e)0!==r&&t.push({op:r,pos:n,text:i}),-1!==r&&(n+=i.length);return t}function l(e){if(!Array.isArray(e))throw Error("Input must be an array");e.forEach((e,t)=>{if(!("object"==typeof e&&null!==e&&"op"in e&&"number"==typeof e.op))throw Error("Invalid change object at index ".concat(t));if(1!==e.op&&-1!==e.op)throw Error("Invalid 'op' value at index ".concat(t));if("number"!=typeof e.pos||!Number.isInteger(e.pos))throw Error("Invalid 'pos' value at index ".concat(t));if("string"!=typeof e.text)throw Error("Invalid 'text' value at index ".concat(t))})}function u(e,t){return function(e,t){let n=e,r=0;for(let e of t){let t=e.pos+r;1===e.op?(n=n.slice(0,t)+e.text+n.slice(t),r+=e.text.length):-1===e.op&&(n=n.slice(0,t)+n.slice(t+e.text.length),r-=e.text.length)}return n}(e,t.map(e=>({op:-e.op,pos:e.pos,text:e.text})).reverse())}function c(e){for(let[t]of e)if(0!==t)return!1;return!0}},28096:function(e,t,n){function r(e){var t;return(null===(t=e.mergeState)||void 0===t?void 0:t.isActive)?e.mergeState.diffSource:e.view.state.doc.toString()}function i(e){return r(e)!==e.baseContent}n.d(t,{li:function(){return r},oI:function(){return i}}),n(71844)},44506:function(e,t,n){n.d(t,{G:function(){return r}});async function r(e){let{createHash:t}=await Promise.all([n.e(2044),n.e(1919)]).then(n.t.bind(n,76736,23));return t("sha256").update(e.trim()).digest("hex").slice(0,6)}},18701:function(e,t,n){n.d(t,{Y:function(){return u}});var r=n(27218),i=n(87033),a=n(58183),o=n(18187),l=n(32559);let u=e=>{var t;let{account:n}=(0,r.t)(),{value:u}=(0,i.FL)("force_harmony"),{data:c,isLoading:s}=(0,l.Yc)(e),{data:d,isLoading:f}=(0,o.SE)(e||""),p=null!==(t=null==d?void 0:d.some(e=>e.account.uuid===(null==n?void 0:n.uuid)&&"user"===e.role))&&void 0!==t&&t,y="showDirectoryPicker"in window&&"FileSystemHandle"in window,m=(0,a.useDynamicConfig)("harmony");return{userHasHarmony:y&&((null==n?void 0:n.settings.preview_feature_uses_harmony)||u)&&m.get("harmonize",!1),projectHasHarmony:!s&&!f&&p&&!!(null==c?void 0:c.is_harmony_project),config:m}}},40030:function(e,t,n){n.d(t,{C:function(){return _},b:function(){return C}});var r=n(27573),i=n(7653),a=n(35919),o=n.n(a);let l=(0,i.createContext)(null),u={openedFiles:[],projectDocs:[],files:[],setFiles:o(),projectUuid:"",syncedDirectories:[],setSyncedDirectories:o()};function c(e){let{children:t,onLoad:n}=e;return(0,i.useEffect)(n,[n]),(0,r.jsx)(l.Provider,{value:u,children:t})}var s=n(80762),d=n(87590),f=n.n(d),p=n(77879),y=n(95899),m=n(85017),v=n(10690),g=n(52902);let h=[];function w(e){let{children:t,onLoad:n,projectUuid:a}=e,{isLoading:o,unfilteredData:u=h}=(0,y.Kf)(a),[c,d]=(0,i.useState)([]),[w,b]=(0,i.useState)([]),_=(0,i.useMemo)(()=>[...(function(e,t){let n=new Map,r=t.filter(g.IQ).map(e=>e.uri);if(!r.length)return n;for(let t of r){let r=new Set;for(let n of e){if(!(0,g.Wx)(n.file_name))continue;let{projectUuid:e,directoryUuid:i}=(0,g.Xp)(n.file_name),a=(0,g.Xp)(t);e===a.projectUuid&&i===a.directoryUuid&&r.add(n.file_name)}n.set(t,r)}return n})(u,c).values()].flatMap(e=>[...e]),[u,c]);(0,i.useEffect)(()=>{(0,m.Zz)(a).then(b).catch(e=>s.v("Harmony: Error initializing synced directories from IndexedDB",e))},[a]);let{mutateAsync:C}=(0,y.u3)(a),{mutateAsync:x}=(0,y.Zy)(a),{mutateAsync:S}=(0,y.ER)(a),E=(0,i.useCallback)(()=>{(0,v.tt)(a,o,c,u,C,x,S).then(e=>{e&&(f()(c,e.updatedFiles)||(d(e.updatedFiles),s.f("Harmony: Resynced ".concat(e.updatedFiles.filter(g.zE).length," files in ").concat(e.updatedFiles.filter(g.IQ).length," directories")),n()))}).catch(e=>s.v("Harmony: Error during resync:",e))},[a,o,c,u,C,x,S,n]),U=(0,i.useRef)(!1);(0,i.useEffect)(()=>{!a||o||U.current||(U.current=!0,E())},[E,a,o]),(0,p.Yz)(E,3e4);let j=(0,i.useMemo)(()=>({projectUuid:a,openedFiles:_,projectDocs:u,files:c,setFiles:d,syncedDirectories:w,setSyncedDirectories:b}),[a,_,u,c,w,b]);return(0,r.jsx)(l.Provider,{value:j,children:t})}var b=n(18701);function _(e){let{children:t,onLoad:n,projectUuid:i}=e,{userHasHarmony:a}=(0,b.Y)(i);return a?(0,r.jsx)(w,{onLoad:n,projectUuid:i,children:t}):(0,r.jsx)(c,{onLoad:n,children:t})}function C(){return(0,i.useContext)(l)||u}},85017:function(e,t,n){n.d(t,{U4:function(){return f},Zz:function(){return s},sN:function(){return d},y3:function(){return p}});var r=n(80762),i=n(52902);let a="directories",o="projectUuid",l=null;async function u(){return l||new Promise((e,t)=>{let n=indexedDB.open("harmony",1);n.onerror=()=>t(n.error),n.onsuccess=()=>{(l=n.result).onerror=e=>{r.v("Database error:",e)},l.onclose=()=>{l=null},e(l)},n.onupgradeneeded=e=>{e.target.result.createObjectStore(a,{keyPath:"uuid"}).createIndex(o,"projectUuid",{unique:!1})}})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"readonly";if(!l)throw Error("Database not initialized");return l.transaction(a,e)}async function s(e){await u();let t=c("readonly").objectStore(a).index(o);return new Promise((n,r)=>{let a=t.getAll(e);a.onerror=()=>r(a.error),a.onsuccess=()=>{n(a.result.map(e=>({...e,uri:(0,i.cT)(e)})))}})}async function d(e){await u();let t=c("readonly").objectStore(a);return new Promise((n,r)=>{let a=t.get(e);a.onerror=()=>r(a.error),a.onsuccess=()=>{if(a.result){let e=a.result;n({...e,uri:(0,i.cT)(e)})}else n(null)}})}async function f(e){return await u(),new Promise((t,n)=>{let r=c("readwrite").objectStore(a).put(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}async function p(e){return await u(),new Promise((t,n)=>{let r=c("readwrite").objectStore(a).delete(e);r.onerror=()=>n(r.error),r.onsuccess=()=>t()})}},10690:function(e,t,n){n.d(t,{Jl:function(){return p},wC:function(){return b},bE:function(){return f},lz:function(){return _},xF:function(){return m},cM:function(){return w},tt:function(){return C},ec:function(){return y}});var r=n(80762),i=n(87590),a=n.n(i),o=n(95899),l=n(71844),u=n(28096),c=n(44506),s=n(85017),d=n(52902);async function f(e){let t=await (0,s.Zz)(e);return await (0,d.C7)(t)}async function p(e,t){return(await (0,d.pJ)(e,t)).text}async function y(e,t,n,i,a,o){let c=await (0,s.Zz)(t),f=Array.from(new Set([...e])).map(async e=>{if((0,d.Wx)(e))try{let t=o(e),s=t?(0,u.li)(t):void 0,d=t?t.baseContent:void 0;if(void 0===d||void 0===s){let t=await p(c,e);if(!s){if(null===t){r.v(Error("File content not found for ".concat(e)));return}return await v(n,i,a,e,t,[])}return await v(n,i,a,e,s,(0,l.b8)(t||"",s))}let f=(0,l.b8)(d,s);return await v(n,i,a,e,s,f)}catch(t){r.v("Error processing file ".concat(e,":"),t)}});await Promise.all(f)}async function m(e,t,n,r,i){let a=await p(e,i);if(null===a)throw Error("File content not found for ".concat(i));if(new TextEncoder().encode(a).length>102400)throw Error("File ".concat(i," is too large and will degrade the experience. Pass a specific view_range when using the view tool for this file."));return await v(t,n,r,i,a)}async function v(e,t,n,r,i,a){let o=e.find(e=>e.file_name===r);if(o&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.match(/<content>([\s\S]*)<\/content>/),r=n&&n[1]?n[1].trim():e;if(t){let t=e.match(/<changes>(.*?)<\/changes>/);if(t&&t[1]){let e=JSON.parse(t[1]);(0,l.YB)(e),r=(0,l.Nc)(r,e)}}return r}(o.content)===i)return o;let u=await g(i,a);return o?await n({docUuid:o.uuid,content:u}):await t({file_name:r,content:u})}async function g(e,t){let n=await (0,c.G)(e),r=void 0!==t&&!(0,l.KA)(t);return"\n<metadata>\n<file_hash>".concat(n,"</file_hash>\n<file_state>\n  ").concat(r&&void 0!==t?"\n  <status>includes_unsaved_changes</status>\n  <message>This content includes modifications since it was last synchronized. You can and should continue to suggest changes using write or replace operations. Your suggestions will be applied to the latest version of the file. THIS IS THE MOST UP TO DATE VERSION OF THE FILE.</message>\n  <changes>".concat(JSON.stringify((0,l.h4)(t)),"</changes>\n"):"<status>synced</status>","\n</file_state>\n</metadata>\n<content>").concat(e,"</content>\n").trim()}async function h(e,t,n,i,a){if(0===e.length){let e=t.find(e=>e.file_name===o.i9);e&&await a({docUuid:e.uuid});return}let l=JSON.stringify(e.map(e=>e.uri),null,2).split("\n"),u=l.slice(0,50).join("\n"),c=l.length-50,s="<synced_resources>\n".concat(u,"\n").concat(c>0?"\n... plus ".concat(c," additional files."):"","\n</synced_resources>"),d=t.filter(e=>e.file_name===o.i9);if(d.length>0){let[e,...n]=d;if(n.length>0&&r.f("Harmony: Cleaning up ".concat(n.length," extra project docs")),await Promise.all(n.map(e=>w(t,e.file_name,a))),e.content===s){r.f("Harmony: Project doc already up to date",e.uuid);return}await i({docUuid:e.uuid,content:s}),r.f("Harmony: Updated project doc",e.uuid)}else{let e=await n({file_name:o.i9,content:s});r.f("Harmony: Created project doc",e.uuid)}}async function w(e,t,n){let r=e.find(e=>e.file_name===t);r&&await n({docUuid:r.uuid})}async function b(e,t,n,r){let{projectUuid:i,directoryUuid:a}=(0,d.Xp)(r),o=(0,d.wq)(e,i,a);for(let e of(await (0,s.y3)(a),t.filter(e=>_(e,o))))await n({docUuid:e.uuid});return e.filter(e=>e!==o)}function _(e,t){if(!(0,d.Wx)(e.file_name))return!1;let{projectUuid:n,directoryUuid:r}=(0,d.Xp)(t.uri),{projectUuid:i,directoryUuid:a}=(0,d.Xp)(e.file_name);return n===i&&r===a}async function C(e,t,n,r,i,o,l){if(!e||t)return;let u=await (0,s.Zz)(e),c=await (0,d.C7)(u);if(!a()(n.map(e=>e.uri),c.map(e=>e.uri))){for(let e of u)e.root.descendants.some(t=>t.lastModified>e.lastUpdated)&&await (0,s.U4)({...e,lastUpdated:Date.now()});return await h(c,r,i,o,l),{updatedFiles:c}}}},52902:function(e,t,n){n.d(t,{O:function(){return w},cn:function(){return v},_I:function(){return g},wq:function(){return C},sy:function(){return x},IQ:function(){return b},zE:function(){return _},Wx:function(){return A},C7:function(){return h},Xp:function(){return D},pJ:function(){return f},cT:function(){return E},NC:function(){return p}});var r=n(5161),i=n(80762),a=n(98940);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}getCacheKey(e,t){return"".concat(e.name,"-").concat(t)}isPermissionExpired(e){return Date.now()-e>this.CACHE_DURATION}async checkPermission(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read",n=this.getCacheKey(e,t),r=this.permissionCache.get(n);if(r&&!this.isPermissionExpired(r.timestamp))return"granted"===r.state;try{if("queryPermission"in e){let r=await e.queryPermission({mode:t});if("granted"===r)return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}if("requestPermission"in e){let r=await e.requestPermission({mode:t});return"granted"===r&&this.permissionCache.set(n,{state:r,timestamp:Date.now(),mode:t}),"granted"===r}return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}catch(e){return i.v("Permission check failed:",e),!1}}constructor(){this.permissionCache=new Map,this.CACHE_DURATION=36e5}}let l=o.getInstance();async function u(e,t){return l.checkPermission(e,t)}var c=n(87376).Buffer;let s="inode/directory";async function d(e,t){let n=await e.getFile();return{handle:e,path:"".concat(t,"/").concat(n.name),lastModified:n.lastModified}}async function f(e,t){let n,i;let{directory:a,file:o}=x(e,t);if(!o)throw Error("File not found: ".concat(t));let l=await o.handle.getFile(),u=null;try{u=await (0,r.CL)(l),i=l.type||"text/plain"}catch(t){let e=await l.arrayBuffer();n=e.byteLength>1048576?"[File truncated due to size]":c.from(e).toString("base64"),i=l.type||"application/octet-stream"}return{uri:S(a,o),mimeType:i,text:u,blob:n}}async function p(e,t){if(!await u(e.handle,"readwrite"))throw Error("Permission denied");let n=await e.handle.getFile();try{await (0,r.CL)(n)}catch(e){throw Error("Cannot write to non-text files")}let a=await e.handle.createWritable();try{await a.write(t)}finally{await a.close()}i.f("Harmony: Wrote file ".concat(e.path," to local file system")),e.lastModified=Date.now()}async function y(e,t){try{return await e.getDirectoryHandle(t,{create:!0})}catch(e){throw Error("Failed to create directory ".concat(t))}}async function m(e,t){let n=e;for(let e=0;e<t.length-1;e++)n=await y(n,t[e]);return n}async function v(e,t,n){let{pathComponents:r}=M(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied");let i=await m(e.root.handle,r),a=r[r.length-1];try{let t={handle:await i.getFileHandle(a,{create:!0}),path:"".concat(e.root.name,"/").concat(r.join("/")),lastModified:Date.now()};return await p(t,n),e.root.descendants.push(t),!0}catch(e){throw Error("Failed to create file ".concat(t," - ").concat(e))}}async function g(e,t){let{pathComponents:n}=M(t);if(!await u(e.root.handle,"readwrite"))throw Error("Permission denied to delete file in the directory");let r=await m(e.root.handle,n),i=n[n.length-1];try{return await r.removeEntry(i),e.root.descendants=e.root.descendants.filter(t=>t.path!=="".concat(e.root.name,"/").concat(n.join("/"))),!0}catch(e){throw Error("Failed to delete file ".concat(i))}}async function h(e){return(await Promise.all(e.map(w))).flat()}async function w(e){try{if(await u(e.root.handle,"read")){let t=await z(e);t&&(e.root=t.updatedDirectoryRoot)}}catch(t){i.v("Harmony: Could not resync ".concat(e.uuid),t)}let t=e.root.descendants.map(t=>({uri:S(e,t)}));return t.unshift({uri:E(e),mimeType:s}),t}function b(e){return e.mimeType===s}function _(e){return!b(e)}function C(e,t,n){let r=e.find(e=>e.projectUuid===t&&e.uuid===n);if(!r)throw Error("Resource not found: ".concat(t,"/").concat(n));return r}function x(e,t){let{projectUuid:n,directoryUuid:r,pathComponents:i}=D(t),a=C(e,n,r);try{let e=function(e,t){let n="".concat(e.root.name,"/").concat(t.join("/")),r=e.root.descendants.find(e=>e.path===n);if(!r)throw Error("File not found: ".concat(n));return r}(a,i);return{directory:a,file:e}}catch(e){return{directory:a,file:null}}}function S(e,t){let n=t.path.split("/").map(encodeURIComponent);return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/")+n.join("/")}function E(e){return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/").concat(encodeURIComponent(e.root.name),"/")}async function U(e,t,n,r){let i=n.flatMap(e=>{if(""===(e=e.trim())||e.startsWith("#"))return[];let t=e.startsWith("!");return t&&(e=e.slice(1)),(e=e.replace(/^\//,"")).endsWith("/")&&(e+="*"),t?["!".concat(e)]:[e]}),o=[],l=[[e,t]],u=e=>{let t=i.filter(e=>!e.startsWith("!")).some(t=>(0,a.s7)(e,t,{dot:!0,matchBase:!0})),n=i.filter(e=>e.startsWith("!")).some(t=>(0,a.s7)(e,t.slice(1),{dot:!0,matchBase:!0}));return t&&!n};for(;l.length>0;){let[e,n]=l.shift();for await(let i of e.values()){if(o.length>=r)throw Error("Maximum number of files (".concat(r,") exceeded"));if(i.name.startsWith(".")&&".gitignore"!==i.name)continue;let e="".concat(n,"/").concat(i.name);if(!u(e.slice(t.length+1))){if("file"===i.kind){let e=await d(i,n);o.push(e)}else l.push([i,e])}}}return o}async function j(e){try{let t=await e.getFileHandle(".gitignore",{create:!1}),n=await t.getFile();return(await n.text()).split("\n").filter(e=>""!==e.trim()&&!e.startsWith("#"))}catch(e){return[]}}async function T(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2500;try{let r=[...await j(e),...t],i=await U(e,e.name,r,n);return{handle:e,name:e.name,descendants:i}}catch(e){if(e instanceof Error&&e.message.includes("Maximum number of files"))throw Error("The size of this directory may cause performance degradation. Please choose a smaller directory.");throw e}}async function z(e){let t;let n=e.root;try{t=await T(e.root.handle,e.ignorePatterns)}catch(e){return null}let r=k(n.descendants),i=k(t.descendants),a=[];for(let[e,t]of r.entries()){let n=i.get(e);if(void 0===n){a.push({type:"removed",file:t});continue}n.lastModified!==t.lastModified&&a.push({type:"modified",file:n}),i.delete(e)}for(let e of i.values())a.push({type:"added",file:e});return{updatedDirectoryRoot:t,fileChanges:a}}function k(e){let t=new Map;for(let n of e)t.set(n.path,n);return t}let P=new Map,I=(e,t)=>{P.size>=1e3&&Array.from(P.keys()).slice(0,Math.floor(200)).forEach(e=>P.delete(e)),P.set(e,t)};function D(e){if(P.has(e))return P.get(e);if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');let t=new URL(e),n=t.host,[r,i,a,...o]=t.pathname.split("/").map(decodeURIComponent);if(!(n&&o.length))throw Error("Invalid URI: Missing required components");let l={projectUuid:n,directoryUuid:i,directoryName:a,pathComponents:o};return I(e,l),l}function A(e){try{return D(e),!0}catch(e){return!1}}function M(e){if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');try{let t=new URL(e),n=t.host,[r,i,a,...o]=t.pathname.split("/").map(decodeURIComponent);if(!n||!i||!a)throw Error("Invalid URI: Missing required components");return{projectUuid:n,directoryUuid:i,directoryName:a,pathComponents:o}}catch(e){throw Error("Invalid URI: ".concat(e.message))}}},26525:function(e,t,n){n.d(t,{Ch:function(){return P},H0:function(){return H},Qe:function(){return T},Vn:function(){return Q},kR:function(){return K},kS:function(){return D}});var r=n(41596),i=n(27573),a=n(5161),o=n(71817),l=n(76220),u=n(3053),c=n(5362),s=n(27218),d=n(27895),f=n(9788),p=n(32737),y=n(30947),m=n(6385),v=n(13262),g=n(87033),h=n(35807),w=n(42755),b=n(45144),_=n(77930),C=n(7653),x=n(45790),S=n(40950),E=n(41496),U=n(1804);function j(){let e=(0,r._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-styrene\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return j=function(){return e},e}let T=20,z=e=>{let t=e.webkitRelativePath;return t&&t.length?t:e.name},k=e=>e.replace(/\0/g,""),P=e=>{e.extracted_content=k(e.extracted_content),e.file_name=k(e.file_name),e.file_type=k(e.file_type)},I=(e,t)=>({file_name:z(e),file_type:e.type,file_size:e.size,extracted_content:t});function D(e){let{syncSourceCount:t,files:n,setFiles:r,numExistingConversationFiles:u,attachments:c,setAttachments:s,numExistingConversationAttachments:f,detectSameAttachment:y,selectedModel:m,blobFileUploadsEnabled:v,customFileUploadHandler:g}=e,{addError:b}=(0,d.e)(),_=(0,o.wN)(null);return function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:r,existingFiles:o,numExistingConversationAttachments:u,numExistingConversationFiles:c,selectedModel:s,blobFileUploadsEnabled:d,customFileUploadHandler:f}=e,y=(0,S.Z)(),{modelConfig:m}=(0,l.Ve)(s),v=m.image_in,[g,b,_,E]=function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:r,existingFiles:o,numExistingConversationFiles:u,selectedModel:c,blobFileUploadsEnabled:s,customFileUploadHandler:d}=e,{modelConfig:f}=(0,l.Ve)(c),p=f.image_in,y=H()&&f.pdf_in,{isUploading:m,setIsUploading:v,handleError:g,handleUpload:h}=Q({imagesEnabled:p,blobFileUploadsEnabled:s,onUploadComplete:n,rasterizePdfUploadsEnabled:y,customFileUploadHandler:d}),w=(0,C.useCallback)(e=>{let{newUploads:n=[],numNewPotentialAttachments:l=0,showError:c=!0}=e,{attachmentUploads:d,imageUploads:f,rasterizedDocumentUploads:m,outOfContextFileUploads:v}=(0,a.Jw)(n,{imagesEnabled:p,blobFileUploadsEnabled:s,rasterizePdfUploadsEnabled:y});return l+d.length+f.length+m.length+v.length+r.length+o.length+t>T?(c&&g((0,i.jsx)(x.Z,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:T}})),!1):!(f.length+m.length+o.length+u>100)||(c&&g((0,i.jsx)(x.Z,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:100,suggestion:u<100?(0,i.jsx)(x.Z,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,i.jsx)(x.Z,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}})),!1)},[p,s,r,o,t,u,g,y]);return[m,v,w,(0,C.useCallback)(async e=>{w({newUploads:e})&&await h(e)},[h,w])]}({syncSourceCount:t,onUploadComplete:n,existingFiles:o,existingAttachments:r,numExistingConversationFiles:c,numExistingConversationAttachments:u,selectedModel:s,blobFileUploadsEnabled:d,customFileUploadHandler:f}),U=function(e){let{handleUpload:t}=e,n=(0,C.useRef)({ready:0,total:0}),r=(0,C.useCallback)(()=>{n.current={ready:0,total:0}},[]),i=(0,C.useCallback)(e=>{n.current.ready+=1,n.current.total===n.current.ready&&t(e)},[t]),a=(0,C.useCallback)((e,t)=>{let r=e.length;for(let o=0;o<r;o++){let r=e[o];r.isFile?(n.current.total+=1,r.file(e=>{t.push(e),i(t)})):r.isDirectory&&r.createReader().readEntries(e=>{a(e,t)})}},[i]);return(0,C.useCallback)(e=>{var t;e.preventDefault(),r();let n=null===(t=e.dataTransfer)||void 0===t?void 0:t.items;if(!n)return;let i=[];for(let e=0;e<(null==n?void 0:n.length);e++){let t=n[e].webkitGetAsEntry();t&&i.push(t)}a(i,[])},[a,r])}({handleUpload:E}),j=(0,C.useCallback)(async e=>{await E(Array.from(e))},[E]),z=(0,C.useCallback)(async e=>{let t=e.target.files;t&&await E(Array.from(t)),e.target.value=""},[E]),k=v?(0,i.jsx)(x.Z,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, 30mb each)",id:"ialBpH0eLp",values:{maxUploads:T}}):(0,i.jsx)(x.Z,{defaultMessage:"Add content ({maxUploads} max, 30mb each)\\nAccepts pdf, txt, csv, etc.",id:"70asB5brJP",values:{maxUploads:T}}),P=(0,C.useCallback)(e=>{z(e)},[z]),I=(0,C.useMemo)(()=>({type:"file",accept:(0,a.tB)({imagesEnabled:v,outOfContextFilesEnabled:d}).join(","),onChange:P,multiple:!0,"aria-label":y.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[d,v,P,y]);return[g,b,_,U,j,E,(0,i.jsx)(p.u,{className:"text-center",tooltipContent:k,children:(0,i.jsxs)(L,{children:[(0,i.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...I}),g?(0,i.jsx)(h.U,{className:"animate-spin",size:18}):(0,i.jsx)(w.p,{size:18,weight:"light"})]})},"upload-tooltip"),I]}({syncSourceCount:t,onUploadComplete:(0,C.useCallback)(async(e,t)=>{y&&e.find(e=>y(e.extracted_content))&&b((0,i.jsx)(x.Z,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so theres no need to re-upload.",id:"Uo3qvhGn7z"})),s(t=>[...t,...e]),r(e=>[...e,...t])},[s,y,b,r]),existingAttachments:c,existingFiles:n,numExistingConversationAttachments:f,numExistingConversationFiles:u,selectedModel:null!=m?m:_,blobFileUploadsEnabled:v,customFileUploadHandler:g})}let A=async(e,t,n)=>{let r=new Image;if(r.src=URL.createObjectURL(e),await new Promise(e=>{r.onload=e,setTimeout(e,250)}),!r.width||!r.height||"image/png"!==e.type&&r.width<=t&&r.height<=n)return e;let i=r.width/r.height,a=r.width,o=r.height;r.width>t&&(o=(a=t)/i),o>n&&(a=(o=n)*i);let l=document.createElement("canvas");l.style.display="none",document.body.appendChild(l);let u=l.getContext("2d");if(!u||!u.imageSmoothingQuality)return document.body.removeChild(l),e;u.imageSmoothingQuality="high",l.width=a,l.height=o,u.drawImage(r,0,0,a,o);let c=await new Promise(e=>{l.toBlob(t=>e(t),"image/webp",.85)});return(document.body.removeChild(l),c)?new File([c],e.name,{type:"image/webp"}):e},M=()=>{let{value:e}=(0,g.FL)("use_canvas_resize");return(0,C.useCallback)(async t=>e?await A(t,2e3,2e3):t,[e])},F=()=>{let e=N(),t=K();return async(n,r,i)=>{try{return await t(n,r,i)}catch(t){e(t,(0,a.Wr)(n)?"image":"file")}}},q=e=>{let t=N(),n=K(),r=(0,c.OJ)();return async(i,a,o)=>{let l={};try{l.file=await n(i,a,o)}catch(n){n instanceof y.Hx&&"document_too_many_pages"===n.errorCode?l.attachment=await O(r,i,a,e):t(n,"document")}return l}},K=()=>{let e=(0,c.OJ)(),t=(0,_.useQueryClient)();return async(n,r,i)=>{let a=new FormData;a.append("file",n);let o=i?"/api/organizations/".concat(r,"/projects/").concat(i,"/upload"):"/api/".concat(r,"/upload"),l=await e(o,{method:"POST",body:a}),u=await l.json();if(l.ok)return i&&t.invalidateQueries({queryKey:[v.rt,{orgUuid:r,projectUuid:i}]}),u;throw(0,y.fT)(l.status,u,"File upload failed",l.headers)}},R=async(e,t,n,r)=>{let a;let o=new FormData;o.append("file",t);try{a=await e("/api/organizations/".concat(n,"/convert_document"),{method:"POST",body:o})}catch(e){return(0,b.Tb)(e),r((0,i.jsx)(x.Z,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"}))}if(429===a.status)return r((0,i.jsx)(x.Z,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"}));if(413===a.status)return r((0,i.jsx)(x.Z,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"}));if(!a.ok)return r((0,i.jsx)(x.Z,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}));let l=await a.json();return l&&0!==Object.keys(l).length&&l.extracted_content?(l.file_name=z(t),l):r((0,i.jsx)(x.Z,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}))},Q=e=>{var t;let{imagesEnabled:n,blobFileUploadsEnabled:r,rasterizePdfUploadsEnabled:o,onUploadComplete:l,onError:f,projectUuid:p,customFileUploadHandler:y}=e,{activeOrganization:v}=(0,s.t)(),g=null!==(t=null==v?void 0:v.uuid)&&void 0!==t?t:"",[h,w]=(0,C.useState)(!1),{addError:b}=(0,d.e)(),_=(0,C.useCallback)(e=>{w(!1),b(e),f&&f()},[b,f,w]),S=M(),U=F(),j=q(_),T=(0,c.OJ)(),z=(0,u.z$)(),k=(0,C.useCallback)(async(e,t)=>{if(y){w(!0);try{let t=await y(e);t&&t.length>0&&await l([],t)}catch(e){_(e instanceof Error?e.message:"File upload failed")}finally{w(!1)}return}let{attachmentUploads:u,imageUploads:c,rasterizedDocumentUploads:s,unsupportedUploads:d,tooLargeUploads:f,outOfContextFileUploads:v}=(0,a.Jw)(e,{imagesEnabled:n,blobFileUploadsEnabled:r,rasterizePdfUploadsEnabled:o}),h=d.map(e=>(0,a.mD)(e.name));if(h.length>0)return _((0,i.jsx)(x.Z,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:h.length,formats:(0,i.jsx)(E.yX,{type:"conjunction",value:[...new Set(h)]})}}));if(f.length>0)return z.track({event_key:"file_upload_too_large",large_files:f.map(e=>({file_type:e.type,file_size:e.size}))}),_((0,i.jsx)(x.Z,{defaultMessage:"You may not upload files larger than 30mb.",id:"Gr/GvEZTX1"}));w(!0);let b=[],C=0,k=(e,n)=>{if(void 0===t)return!0;let r=new Blob([n]).size/m.r6;return!((C+=r)>t)||(_((0,i.jsx)(x.Z,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:e}})),!1)};for(let e of u){let t=await O(T,e,g,_);if(!(t&&k(e.name,t.extracted_content)))return;await l([t],[])}for(let e of c){let t=await S(e),n=await U(t,g,p);n&&b.push(n)}for(let e of s){let{file:t,attachment:n}=await j(e,g,p);if(t&&b.push(t),n){if(!k(e.name,n.extracted_content))return;await l([n],[])}}for(let e of v){let t=await U(e,g,p);t&&b.push(t)}await l([],b),w(!1)},[r,T,l,n,_,U,j,g,S,z,o,p,y]);return{isUploading:h,setIsUploading:w,handleError:_,handleUpload:k}},L=f.q.label(j()),O=async(e,t,n,r)=>{if(!(0,a.dF)(t))try{let e=await (0,a.CL)(t);return I(t,e)}catch(e){}let i=await R(e,t,n,r);if(i)return P(i),i},N=()=>{let{addError:e}=(0,d.e)();return(0,C.useCallback)((t,n)=>{if(t instanceof y.Hx){if("rate_limit_error"===t.type){e((0,i.jsxs)("p",{children:[(0,i.jsx)(x.Z,{defaultMessage:"Youve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:n}}),(0,i.jsx)(U.o,{})]}));return}if("document_password_protected"===t.errorCode){e((0,i.jsx)("p",{children:(0,i.jsx)(x.Z,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}));return}}if(t instanceof y.Hx&&"Image is too large"===t.message){e((0,i.jsx)("p",{children:(0,i.jsx)(x.Z,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,i.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}));return}e((0,i.jsx)("p",{children:(0,i.jsx)(x.Z,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:n}})}))},[e])},H=()=>{let{value:e}=(0,g.FL)("janus_claude-ai");return e}},5161:function(e,t,n){n.d(t,{CL:function(){return T},Jw:function(){return E},Wr:function(){return C},dF:function(){return U},eh:function(){return z},mD:function(){return b},tB:function(){return g},wI:function(){return s}});var r=n(27218),i=n(1812),a=n(87033),o=n(18916);let l=[".DS_Store"],u=["jpg","jpeg","png","gif","webp"],c=["image/jpeg","image/png","image/gif","image/webp"],s={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},d=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip"],f=["xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],p=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],y=["docx","rtf","epub","odt","odp","pdf"],m=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],v=["csv"],g=e=>{let{imagesEnabled:t=!1,outOfContextFilesEnabled:n=!1}=e;return[".pdf",".doc",".docx",".rtf",".epub",".odt",".odp",".pptx",...w(),...t?h():[],...n?f.map(e=>".".concat(e)):[]]},h=()=>u.map(e=>".".concat(e)),w=()=>p.map(e=>".".concat(e)),b=e=>e.split(".").pop().toLowerCase(),_=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:r=!1}=t,i=b(e.name);return!!(!n&&(u.includes(i)||c.includes(e.type)))||(r?d.includes(i):[...d,...f].includes(i))},C=e=>{let t=b(e.name);return u.includes(t)||c.includes(e.type)},x=e=>[...v,...f].includes(b(e.name)),S=e=>!!l.includes(e.name),E=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:r=!1,rasterizePdfUploadsEnabled:i}=t,a=[],o=[],l=[],u=[],c=[],s=[];return e.filter(e=>!S(e)).forEach(e=>{let t=n&&C(e);_(e,{imagesEnabled:n,blobFileUploadsEnabled:r})?c.push(e):e.size>3e7?s.push(e):r&&x(e)?l.push(e):i&&("pdf"===b(e.name)||"application/pdf"===e.type)?u.push(e):U(e)?a.push(e):t?o.push(e):a.push(e)}),{attachmentUploads:a,imageUploads:o,rasterizedDocumentUploads:u,unsupportedUploads:c,tooLargeUploads:s,outOfContextFileUploads:l}},U=e=>{let t=b(e.name);return y.includes(t)||m.includes(e.type)},j=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let n=!0,r=Math.min(t.length-1,1e3);for(let e=0;e<r;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){n=!1;break}if(n)return"utf-16";let i=!0,a=!1;for(let e=0;e<t.length;e++){let n=t[e];if(n>127){if(a=!0,(224&n)==192){if(e+1>=t.length||(192&t[e+1])!=128){i=!1;break}e+=1}else if((240&n)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){i=!1;break}e+=2}else if((248&n)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){i=!1;break}e+=3}else{i=!1;break}}}if(i&&a)return"utf-8";let o=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let n=0;n<t.total;n++){let r=e[n];r<32?t.control++:r<127?t.ascii++:r>127&&(t.nonAscii++,(r>=192&&r<=255||r>=168&&r<=183)&&t.cyrillic++,(r>=128&&r<=159||r>=160&&r<=255)&&t.latin1++)}return t})(t),l=o.cyrillic/o.total*100,u=o.latin1/o.total*100,c=o.ascii/o.total*100;if(o.nonAscii>0){if(l>.3)return"windows-1251";if(u>o.control/o.total*100)return"windows-1252"}return c>90&&o.control/o.total<.1?"ascii":"utf-8"},T=async e=>{let t=await e.arrayBuffer(),n=j(t);try{return new TextDecoder(n,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==n)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")};function z(){var e;let{value:t}=(0,a.FL)("ooc_attachments"),{account:n}=(0,r.t)(),l=(0,i.T)(),u=null!==(e=null!=l?l:null==n?void 0:n.settings)&&void 0!==e?e:{},{value:c}=(0,o.h)(u);return!!t&&c}},64295:function(e,t,n){function r(e){return"text"===e.type&&e.text?{...e,text:e.text.replace("","")}:e.content?{...e,content:e.content.map(r)}:e}n.d(t,{A5:function(){return i},_B:function(){return r}});let i=e=>{let t="",n=0,r=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("doc"===e.type&&e.content)for(let t of e.content)r(t);else if("paragraph"===e.type){if(e.content)for(let t of e.content)r(t);t+="\n"}else if("text"===e.type){let n=e.text;if(e.marks)for(let t of e.marks)"bold"===t.type?n="**".concat(n,"**"):"italic"===t.type?n="*".concat(n,"*"):"underline"===t.type?n="__".concat(n,"__"):"strike"===t.type?n="~~".concat(n,"~~"):"code"===t.type&&(n="`".concat(n,"`"));t+=n}else if("codeBlock"===e.type){let n=e.attrs&&"string"==typeof e.attrs.language?e.attrs.language:"";if(t+="\n```".concat(n,"\n"),e.content)for(let t of e.content)r(t);t+="\n```\n\n"}else if("bulletList"===e.type&&e.content)for(let t of e.content)r(t);else if("orderedList"===e.type&&e.content)for(let t=0;t<e.content.length;t++)r(e.content[t],t+1,!0);else if("listItem"===e.type&&e.content){let o="   ".repeat(n);for(let l of(a?t+="".concat(o).concat(i,". "):t+="".concat(o,"* "),e.content))n+=1,r(l),n-=1}};return r(e),t.replace("","").trim()}},18916:function(e,t,n){n.d(t,{h:function(){return a}});var r=n(87033),i=n(58183);function a(e){let t=(0,i.useLayer)("frontend").get("analysis_tool_experiment_enabled",!1),{value:n}=(0,r.FL)("rely_on_analysis_flag"),{value:a}=(0,r.FL)("analysis_tool_launch_ga");if(n){var o;return{value:null!==(o=null==e?void 0:e.enabled_artifacts_attachments)&&void 0!==o?o:a,source:"flag"}}return{value:(null==e?void 0:e.enabled_artifacts_attachments)||t,source:"experiment"}}},76220:function(e,t,n){n.d(t,{E6:function(){return y},Ve:function(){return s},uL:function(){return p}});var r=n(5362),i=n(27218),a=n(13262),o=n(87033),l=n(98649),u=n(41270);let c={image_in:!1,pdf_in:!1},s=e=>{let{activeOrganization:t}=(0,i.t)(),n=null==t?void 0:t.uuid,{data:l,isLoading:u,isPlaceholderData:s}=(0,r.WE)("/api/organizations/".concat(n,"/model_configs/").concat(e),{queryKey:[a.Qn,n,e],enabled:!!n,staleTime:3e5,meta:{noToast:!0}}),d=!s&&l||c,{value:f}=(0,o.FL)("claude_ai_cinnamon");return"claude-3-5-haiku-20241022"===e&&f&&(d={image_in:!0,pdf_in:!1}),{isLoading:u,modelConfig:d}},d=u.z.array(u.z.object({model:u.z.string(),name:u.z.string(),description:u.z.string().optional(),notice_text:u.z.string().optional(),inactive:u.z.boolean().optional(),overflow:u.z.boolean().optional(),knowledgeCutoff:u.z.string().optional(),slow_kb_warning_threshold:u.z.number().optional(),paprika_modes:u.z.array(l.Xs).optional(),capabilities:u.z.object({mm_pdf:u.z.boolean().optional(),mm_images:u.z.boolean().optional(),web_search:u.z.boolean().optional(),gsuite_tools:u.z.boolean().optional(),compass:u.z.boolean().optional()}).optional()})),f=[],p=()=>{let e=(0,o.Zr)("claude_ai_models","models",f,d),t=e.filter(e=>!e.inactive),n=t.filter(e=>!e.overflow),r=t.filter(e=>e.overflow);return{allModelOptions:e,activeModelOptions:t,mainModels:n,overflowModels:r}},y=()=>{let{allModelOptions:e}=p();return(t,n)=>{let r=e.find(e=>e.model===t);if(!r)return!1;let i=null==r?void 0:r.capabilities;return!i||!1!==i[n]}}},6766:function(e,t,n){n.d(t,{M:function(){return u}});var r=n(87033),i=n(5068),a=n(7653),o=n(71817),l=n(76220);let u=()=>{let e="sticky-model-selector",{value:t}=(0,r.FL)("sticky_model_selector"),{value:n}=(0,r.FL)("model_selector_enabled"),{activeModelOptions:u}=(0,l.uL)(),c=(0,o.wN)(null),s=(0,i.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let r=localStorage.getItem(e);return r===c?null:r&&u.find(e=>e.model===r)?r:null},initialData:null}),d=(0,a.useCallback)(t=>{t&&localStorage.setItem(e,t),s.refetch()},[s]);return{stickyModelPreference:s.data,setStickyModelPreference:d}}},80762:function(e,t,n){function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}n.d(t,{f:function(){return r},v:function(){return i}})},70773:function(e,t,n){function r(e){return e.normalize("NFKC").replace(RegExp("[\\p{Cf}\\p{Co}\\p{Cn}]","gu"),"").replace(RegExp("[\\p{Cc}]","gu"),e=>"\n"===e||"	"===e||"\r"===e?e:"")}n.d(t,{G:function(){return r},Q:function(){return function e(t){if("string"==typeof t)return r(t);if(Array.isArray(t))return t.map(e);if(null!==t&&"object"==typeof t){let n={};for(let[r,i]of Object.entries(t))n[e(r)]=e(i);return n}return t}}})}}]);