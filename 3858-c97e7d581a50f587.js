"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3858],{19132:function(e,t,n){n.d(t,{BZ:function(){return w},Bl:function(){return k},LZ:function(){return C},M1:function(){return p},QD:function(){return A},_3:function(){return I},gb:function(){return x},hJ:function(){return v},j5:function(){return K},sf:function(){return E},tc:function(){return _},te:function(){return D},xm:function(){return U},xn:function(){return m}});var r=n(19170),a=n(5362),u=n(27218),i=n(27895),o=n(30947),s=n(13262),c=n(87033),l=n(10228),d=n(88755),f=n(77930),g=n(81695),y=n(7653),h=n(68571);let v=e=>e.type===l.Fg.GITHUB?{sync_source_type:l.Fg.GITHUB,sync_source_config:e.config}:e.type===l.Fg.GDRIVE?{sync_source_type:l.Fg.GDRIVE,sync_source_config:e.config}:null,_=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid;return(0,a.WE)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[s.FU,{orgUUID:t}],enabled:!!e})},p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid,r=(0,f.useQueryClient)();return(0,a.Ne)("/api/organizations/".concat(n,"/sync/settings"),"PUT",(e,t)=>{let{type:n,enabled:r}=e;t||(t=[]);let a=t.map(e=>e.type===n?{...e,enabled:r}:e);return a.some(e=>e.type===n)?a:[...t,{type:n,enabled:r}]},{queryKey:[s.FU,{orgUUID:n}],enabled:!!t,onSuccess:async function(){for(var t,a=arguments.length,u=Array(a),i=0;i<a;i++)u[i]=arguments[i];await r.invalidateQueries({queryKey:[s.FU,{orgUUID:n}]}),await (null===(t=e.onSuccess)||void 0===t?void 0:t.call(e,...u))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid,r=(0,f.useQueryClient)(),{value:i}=(0,c.FL)("kingfisher_enabled"),{value:o}=(0,c.FL)("apps_use_bananagrams");return(0,a.Ne)("/api/organizations/".concat(n,"/sync/settings/config"),"POST",(e,t)=>{let{type:n,config:r}=e;return t||(t=[]),t.map(e=>e.type===n?{...e,config:{...e.config,...r}}:e)},{queryKey:[s.FU,{orgUUID:n}],enabled:!!(t&&i&&o),onSuccess:async function(){for(var t,a=arguments.length,u=Array(a),i=0;i<a;i++)u[i]=arguments[i];await r.invalidateQueries({queryKey:[s.FU,{orgUUID:n}]}),await (null===(t=e.onSuccess)||void 0===t?void 0:t.call(e,...u))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},b=(e,t)=>{let n=new URLSearchParams(Array.from(t.entries()));n.delete(e);let r=n.toString()?"?".concat(n.toString()):"",a=window.location.pathname+r;window.history.replaceState({...window.history.state,as:a,url:a},"",a)},w=e=>{let{callerIdentifier:t,successParam:n,handleOpen:r}=e,a=(0,g.useSearchParams)(),u=(0,y.useRef)(!1);(0,y.useEffect)(()=>{!a.has(n)||u.current||t&&t!==a.get(n)||(u.current=!0,b(n,a),r())},[a,t,r,n])},C=e=>{let{pathname:t,searchParams:n,queryString:r,isClaudeApp:a}=e,u="".concat(t,"?").concat(r),i=n.get("origin");if(i)u=i;else if(a){let e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,n=t.startsWith("/project/")&&e.test(t.slice(9)),a=t.startsWith("/chat/")&&e.test(t.slice(6));u="claude://claude.ai".concat(n||a||"/new"===t?t:"/new","?").concat(r)}return u},S=e=>[l.co.CREATED,l.co.PENDING,l.co.UPDATING].includes(e),E=e=>S(e.status.state),U=e=>[l.co.FAILED,l.co.UPDATE_FAILED].includes(e.status.state),T=e=>{if(e instanceof o.Hx)return e instanceof o.Hx&&"access_denied"===e.errorCode},x=()=>{let{addError:e}=(0,i.e)(),t=(0,f.useQueryClient)();return(n,r)=>{T(n)&&(e("Please try again. You may need to reconnect with your ".concat(l.hP[r.sync_source_type]," account.")),s.Su.forEach(e=>{t.invalidateQueries({queryKey:[e]})}),t.invalidateQueries({queryKey:[s.cF]}))}},P={[l.Fg.GCAL]:"enabled_foccacia",[l.Fg.GMAIL]:"enabled_sourdough"},I=e=>{let t=e===l.Fg.GCAL||e===l.Fg.GMAIL?"pumpernickel_enabled":"cinnabon_enabled",{value:n}=(0,c.FL)(t);return!h.env.NEXT_PUBLIC_DISABLE_INTEGRATIONS&&n},Q=e=>{let t=(0,u.Cf)(),{data:n}=_(),r=!!(Array.isArray(n)&&n.find(t=>t.type===e&&t.enabled));return!t||r},D=e=>{let t=Q(e);return!!(I(e)&&t)},q=e=>"sfdc"===e?"salesforce":e,A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,u.t)(),r=null==n?void 0:n.uuid,i=(0,g.useRouter)(),o=(0,g.usePathname)(),s=(0,g.useSearchParams)(),{callerIdentifier:c,handleAuthSuccess:l}=t,h=D(e),v=(0,f.useQueryClient)(),_=(0,d.Q)(),{data:p,isFetched:m}=(0,a.WE)("/api/organizations/".concat(r,"/sync/").concat(q(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:r}],enabled:!!(n&&h)}),b=(0,y.useRef)(!1),{mutate:S}=(0,a.uC)("/api/organizations/".concat(r,"/sync/").concat(q(e),"/auth/start"),"POST",{enabled:!!(n&&h),onSuccess:e=>{i.push(e.redirect_url)}});w({callerIdentifier:c,successParam:"".concat(e,"_success"),handleOpen:()=>null==l?void 0:l(!0)});let{mutate:E}=(0,a.uC)("/api/organizations/".concat(r,"/sync/").concat(q(e),"/auth"),"DELETE",{enabled:!!(n&&h),onSuccess:()=>{v.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:r}]})}});return{isAuthenticated:h&&!!(null==p?void 0:p.is_authenticated),startAuth:()=>{if(!b.current&&h){let t=C({pathname:o,searchParams:s,queryString:"".concat(e,"_success=").concat(c),isClaudeApp:_});if(_){window.open("/settings/integrations?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(t));return}b.current=!0,S({pre_auth_state:{origin:t},redirect_uri:new URL("/connect/".concat(q(e),"/callback"),window.location.origin).toString()})}},disconnect:E,isFetched:m}},K=(e,t)=>{var n,r;let a=D(e),{account:i}=(0,u.t)(),o=P[e];return o?a&&(t?!!(null==t?void 0:null===(n=t.conversationSettings)||void 0===n?void 0:n[o]):!!(null==i?void 0:null===(r=i.settings)||void 0===r?void 0:r[o])):a},k=()=>{let{account:e}=(0,u.t)(),{mutate:t}=(0,r.Ck)();return{toggleIntegrationEnabled:(n,r)=>{if(!e)return;let a=P[n];a&&t({...e.settings,[a]:r})}}}},28803:function(e,t,n){n.d(t,{V0:function(){return w},bf:function(){return C},OD:function(){return M},m:function(){return E},$Y:function(){return I},$H:function(){return P},j1:function(){return Q},f7:function(){return D},Pe:function(){return U},j7:function(){return G},Rq:function(){return m},Cy:function(){return A},cE:function(){return b},CJ:function(){return K},_C:function(){return T},QR:function(){return S},y6:function(){return B},cc:function(){return x},gm:function(){return q},Ke:function(){return F},T$:function(){return W},fc:function(){return O},W:function(){return j},PD:function(){return k},Gk:function(){return V},gK:function(){return N},Ls:function(){return z},jl:function(){return R}});var r=n(3053),a=n(5362),u=n(27218),i=n(1812),o=n(98731),s=n(13262),c=n(7653);function l(e){let t=JSON.stringify(e);return(0,c.useMemo)(()=>e,[t])}var d=n(51432),f=n(45144),g=n(77930),y=n(50803),h=n(87590),v=n.n(h),_=n(81695),p=n(1146);let m=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,u.t)(),r=null==n?void 0:n.uuid,[a,i]=(0,c.useReducer)(e=>e+1,0),o=l([s.I8,{orgUUID:r},{uuid:e}]),d=(0,c.useMemo)(()=>t.getQueryData(o),[t,o,e,a]);return(0,c.useEffect)(()=>t.getQueryCache().subscribe(e=>{"updated"===e.type&&"success"===e.action.type&&(0,y._x)({queryKey:o},e.query)&&i()}),[t,i,o]),{data:d}},b=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,u.t)(),r=null==n?void 0:n.uuid,a=l([s.I8,{orgUUID:r},{uuid:e}]);return t.getQueryData(a)},w=30,C=1e4,S=e=>{let{limit:t,offset:n,enabled:r=!0,starred:i}=e,{activeOrganization:o}=(0,u.t)(),c=null==o?void 0:o.uuid,l=new URLSearchParams;void 0!==t&&l.append("limit",t.toString()),void 0!==n&&l.append("offset",n.toString()),void 0!==i&&l.append("starred",i.toString());let d=l.toString();return d=d?"?".concat(d):"",(0,a.WE)("/api/organizations/".concat(null!=c?c:"","/chat_conversations").concat(d),{queryKey:[s.tv,{orgUUID:c},{limit:t,offset:n,starred:i}],staleTime:3e5,enabled:!!c&&r})},E=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid;return(0,a.WE)("/api/organizations/".concat(t,"/chat_conversations/count"),{queryKey:[s.Dn,{orgUUID:t}],staleTime:3e5,enabled:!!t})},U=()=>{let{activeOrganization:e}=(0,u.t)(),t=(0,a.OJ)();return(0,c.useCallback)(async n=>{let{limit:r,offset:a}=n,u=new URLSearchParams;void 0!==r&&u.append("limit",r.toString()),void 0!==a&&u.append("offset",a.toString());let i=u.toString();return i=i?"?".concat(i):"",(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/chat_conversations").concat(i))).json()},[null==e?void 0:e.uuid,t])},T=function(e){let{suppressError:t,enabled:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{enabled:!0},{activeOrganization:r}=(0,u.t)(),i=null==r?void 0:r.uuid,o=(0,c.useRef)([]),l=(0,g.useQueryClient)(),d="/api/organizations/".concat(null!=i?i:"","/chat_conversations/").concat(e,"?tree=True&rendering_mode=messages&render_all_tools=true"),f=(0,a.WE)(d,{queryKey:[s.I8,{orgUUID:i},{uuid:e}],staleTime:3e5,enabled:!!i&&!!e&&n,meta:{noToast:t}},t=>(l.invalidateQueries({queryKey:[s.Gj,{orgUUID:i,conversationUUID:e}]}),(0,p.fX)(t))),y=(0,c.useMemo)(()=>{if(!f.data)return o.current=[],o.current;let e=(0,p.kX)(f.data);if(e.length!==o.current.length||e.some((e,t)=>{var n;return e.uuid!==(null===(n=o.current[t])||void 0===n?void 0:n.uuid)}))return o.current=e,o.current;for(let t=0;t<e.length;t++)v()(e[t],o.current[t])||(o.current[t]=e[t]);return o.current},[f.data]);return{...f,currentPath:y}},x=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,u.t)(),r=null==n?void 0:n.uuid;return(0,c.useCallback)(()=>{t.invalidateQueries({queryKey:[s.I8,{orgUUID:r},{uuid:e}]})},[t,r,e])},P=(e,t)=>{let{mutateAsync:n}=I(),r=(0,_.useRouter)(),a=t||(0,d.H)();return(0,c.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:void 0,controlsOpen:!1},u={uuid:a,name:"",model:t.model};t.createMode&&(u.create_mode=t.createMode),t.projectUuid&&(u.project_uuid=t.projectUuid),n(u).then(()=>{let n="/chat/".concat(a).concat(t.controlsOpen?"?controls=1":"");r[e](n)}).catch(e=>{(0,f.Tb)(e)})},[n,r,e,a])},I=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid,n=(0,g.useQueryClient)(),r=e=>[s.I8,{orgUUID:t},{uuid:e}];return(0,a.uC)("/api/organizations/".concat(null!=t?t:"","/chat_conversations"),"POST",{enabled:!!t,onSuccess:e=>{n.setQueryData(r(e.uuid),t=>({...t||{},...e,chat_messages:(null==t?void 0:t.chat_messages)||[],messageByUuid:new Map,parentByChildUuid:new Map,childrenByParentUuid:new Map,selectedChildByUuid:new Map}))}})},Q=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid,n=(0,g.useQueryClient)();return(0,a.Ne)(e=>{let{uuid:n}=e;return"/api/organizations/".concat(null!=t?t:"","/chat_conversations/").concat(n)},"DELETE",(e,t)=>{let{uuid:n}=e;if(!t)return[];let r=t.findIndex(e=>e.uuid===n);if(!(r>-1))return t;{let e=[...t];return e.splice(r,1),e}},{enabled:!!t,queryKey:[s.tv,{orgUUID:t}],onSuccess:async(e,r)=>{let{uuid:a,projectUuid:u}=r;await n.invalidateQueries({queryKey:[s.I8,{orgUUID:t},{uuid:a}]}),u&&await n.invalidateQueries({queryKey:[s.lx,{orgUuid:t,projectUuid:u}]}),await H(n,t)}})},D=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid,r=(0,g.useQueryClient)();return(0,a.uC)("/api/organizations/".concat(n,"/chat_conversations/delete_many"),"POST",{onSuccess:async t=>{await H(r,n),e&&e(t)}})},q=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid,n=null==e?void 0:e.capabilities.includes("raven");return(0,a.WE)("/api/organizations/".concat(t,"/shares"),{queryKey:[s.PB,{orgUUID:t}],enabled:!!t&&n,staleTime:3e5})},A=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid;return(0,a.WE)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/latest"),{enabled:!!n&&!!e,queryKey:[s.Gj,{orgUUID:n,conversationUUID:e}],staleTime:0,meta:{noToast:!0}},e=>{let{snapshot:t,shareable:n,disabled_reason:r}=e;return{shareable:n,disabled_reason:r,snapshot:t?{...t,chat_messages:t.chat_messages.map(e=>(0,p.Dk)(e))}:null}})},K=e=>{let{activeOrganization:t,account:n}=(0,u.t)(),r=null==t?void 0:t.uuid,i=n&&r?"/api/organizations/".concat(r,"/chat_snapshots/").concat(e,"?rendering_mode=messages&render_all_tools=true"):"/api/chat_snapshots/".concat(e,"?rendering_mode=messages&render_all_tools=true");return(0,a.WE)(i,{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[s.ld,{orgUUID:r,snapshotUUID:e}]},e=>({...e,chat_messages:e.chat_messages.map(e=>(0,p.Dk)(e))}))},k=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid,r=(0,g.useQueryClient)();return(0,a.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/share"),"POST",{onSuccess:()=>{r.invalidateQueries({queryKey:[s.Gj,{orgUUID:n,conversationUUID:e}]}),r.invalidateQueries({queryKey:[s.PB,{orgUUID:n}]}),r.invalidateQueries({queryKey:[s.VH,{orgUUID:n}]})}})},z=(e,t)=>{let{activeOrganization:n}=(0,u.t)(),r=null==n?void 0:n.uuid,i=(0,g.useQueryClient)();return(0,a.uC)("/api/organizations/".concat(r,"/share/").concat(t),"DELETE",{enabled:!!r&&!!t,meta:{errorMessage:"There was an error while trying to unshare the conversation. Please try again."},onSuccess:()=>{i.invalidateQueries({queryKey:[s.Gj,{orgUUID:r,conversationUUID:e}]}),i.invalidateQueries({queryKey:[s.PB,{orgUUID:r}]}),i.invalidateQueries({queryKey:[s.VH,{orgUUID:r}]})}})},B=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid;return(0,a.WE)("/api/organizations/".concat(n,"/artifact-versions/").concat(e),{retry:!1,refetchInterval:!1,enabled:!!e&&!!n,staleTime:0,queryKey:[s.qB,{artifactVersionUUID:e}]})},F=function(e,t,n){var o,c,l;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{track:f}=(0,r.z$)(),y=null!==(c=null===(o=(0,i.T)())||void 0===o?void 0:o.preview_feature_uses_artifacts)&&void 0!==c&&c,{activeOrganization:h}=(0,u.t)(),v=null==h?void 0:h.uuid,_=(0,g.useQueryClient)(),p=[s.I8,{orgUUID:v},{uuid:e}];return(0,a.uC)("/api/organizations/".concat(null!=v?v:"","/chat_conversations/").concat(e,"/chat_messages/").concat(null!==(l=t.uuid)&&void 0!==l?l:"","/chat_feedback"),t.chat_feedback?"PUT":"POST",{enabled:!!v,meta:{errorMessage:"We could not save your feedback. Please try again later."},...d,onSuccess(){for(var r,a,u=arguments.length,i=Array(u),o=0;o<u;o++)i[o]=arguments[o];f({event_key:"claudeai.conversation.feedback.sent",message_uuid:t.uuid,conversation_uuid:e,artifacts_enabled:y,conversationHasArtifacts:n,type:null===(r=t.chat_feedback)||void 0===r?void 0:r.type}),_.invalidateQueries({queryKey:p}),null===(a=d.onSuccess)||void 0===a||a.call(d,...i)}})},L=()=>{let e=(0,g.useQueryClient)(),{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid;return(0,c.useCallback)((t,r)=>{t&&(e.setQueryData([s.I8,{orgUUID:n},{uuid:t}],e=>e&&{...e,...r}),e.setQueriesData({queryKey:[s.tv,{orgUUID:n}]},e=>null==e?void 0:e.map(e=>e.uuid!==t?e:{...e,...r})))},[n,e])},j=e=>{let t=(0,g.useQueryClient)(),{activeOrganization:n}=(0,u.t)(),r=null==n?void 0:n.uuid,i=L();return(0,a.uC)("/api/organizations/".concat(r,"/chat_conversations/").concat(e),"PUT",{onMutate:n=>{var a;let{name:u}=n,o=t.getQueryData([s.I8,{orgUUID:r},{uuid:e}]);return i(e,{name:u}),{oldTitle:null!==(a=null==o?void 0:o.name)&&void 0!==a?a:""}},onError(t,n,r){r&&i(e,{name:r.oldTitle})}})},G=e=>{let t=L(),{activeOrganization:n}=(0,u.t)();return(0,a.uC)("/api/organizations/".concat(null==n?void 0:n.uuid,"/chat_conversations/").concat(e,"/title"),"POST",{onSuccess(n){let{title:r}=n;t(e,{name:null!=r?r:""})},meta:{noToast:!0}})};function M(e){var t,n;let r=(0,o.K)(e);return r+" "+e.attachments.map(e=>e.extracted_content).join(" ")+" "+((null===(t=e.content)||void 0===t?void 0:t.filter(e=>"tool_use"===e.type).map(e=>e.input?JSON.stringify(e.input):e.partial_json||"").join(" "))||"")+" "+((null===(n=e.content)||void 0===n?void 0:n.filter(e=>"tool_result"===e.type).flatMap(e=>e.content.filter(e=>"text"===e.type).map(e=>e.text)).join(" "))||"")}let N=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid;return(0,a.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/stop_response"),"POST")},O=()=>{let{activeOrganization:e}=(0,u.t)(),t=null==e?void 0:e.uuid;return(0,a.uC)(e=>{let{conversation_uuid:n}=e;return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/tool_result")},"POST",{enabled:!!t,meta:{errorMessage:"We could not record the tool result. Please try again later."},transformVariables:e=>{let{conversation_uuid:t,...n}=e;return n}})},R=e=>{let{activeOrganization:t}=(0,u.t)(),n=null==t?void 0:t.uuid;return(0,a.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/current_leaf_message_uuid"),"PUT")},W=(e,t)=>{let{activeOrganization:n}=(0,u.t)(),r=(0,g.useQueryClient)(),i=null==n?void 0:n.uuid;return(0,a.Ne)("/api/organizations/".concat(i,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,settings:{...t.settings,...e.settings}}:void 0,{enabled:!!e,onSuccess:()=>{H(r,i)},onSettled:()=>{(null==t?void 0:t.refetchOnSettled)&&r.refetchQueries({queryKey:[s.I8,{orgUUID:i},{uuid:e}]})},queryKey:[s.I8,{orgUUID:i},{uuid:e}]})},H=async(e,t)=>{await Promise.all([e.invalidateQueries({queryKey:[s.tv,{orgUUID:t}]}),e.invalidateQueries({queryKey:[s.Dn,{orgUUID:t}]})])},V=e=>{let{activeOrganization:t}=(0,u.t)(),n=(0,g.useQueryClient)(),r=null==t?void 0:t.uuid;return(0,a.Ne)("/api/organizations/".concat(r,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{H(n,r)},queryKey:[s.I8,{orgUUID:r},{uuid:e}]})}},1146:function(e,t,n){n.d(t,{Dk:function(){return f},Ef:function(){return c},FC:function(){return i},Gg:function(){return l},HX:function(){return h},QC:function(){return s},fX:function(){return y},kX:function(){return _},mj:function(){return p},vv:function(){return v},w$:function(){return d},wZ:function(){return o}});var r=n(45144),a=n(52221),u=n.n(a);let i="new-assistant-message-uuid",o="new-human-message-uuid",s="00000000-0000-4000-8000-000000000000",c=e=>e!==i;function l(e,t){let n=e.get(t);if(void 0===n){let e=Error("Key not found: ".concat(t));throw(0,r.Tb)(e),e}return n}let d=(e,t)=>{let n=null!=t?t:e.current_leaf_message_uuid;if(!n)return e;for(;n!==s;){var r;let t=l(e.parentByChildUuid,n),a=null===(r=l(e.childrenByParentUuid,t))||void 0===r?void 0:r.indexOf(n);e.selectedChildByUuid.set(t,a),n=t}return{...e,current_leaf_message_uuid:t}},f=e=>e.content?e:{...e,content:[{type:"text",text:e.text||"",citations:[]}]},g=e=>{var t,n,r;let a=new Map,u=new Map,i=new Map,o=new Map,c=new Map;if(0===e.chat_messages.length)return{messageByUuid:u,parentByChildUuid:i,childrenByParentUuid:o,selectedChildByUuid:c};let l=e.chat_messages.map(f);for(let e of l)a.set(e.index,e),u.set(e.uuid,e);for(let e of l){let t=e.parent_message_uuid;if(!t){let r=e.index-1;for(;!t&&r>=0;)t=null===(n=a.get(r))||void 0===n?void 0:n.uuid,r--}t=null!=t?t:s,i.set(e.uuid,t),o.set(t,(null!==(r=o.get(t))&&void 0!==r?r:[]).concat(e.uuid)),c.set(t,0)}if(!(null===(t=o.get(s))||void 0===t?void 0:t[0]))throw Error("No root message found");return{chat_messages:l,messageByUuid:u,parentByChildUuid:i,childrenByParentUuid:o,selectedChildByUuid:c}},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Set;for(let t of e.chat_messages)"assistant"===t.sender&&t.parent_message_uuid&&n.add(t.parent_message_uuid);let r=e.chat_messages.filter(e=>"assistant"===e.sender||n.has(e.uuid)||void 0===e.parent_message_uuid||t),a={...e,chat_messages:r},u={...a,...g(a)};return u.current_leaf_message_uuid||d(u),d(u,a.current_leaf_message_uuid)},h=e=>{let t=Array.from(e.messageByUuid.values()).map(e=>e.index);return 0===t.length?-1:Math.max(...t)},v=(e,t)=>{for(let r of(e.chat_messages=e.chat_messages.concat(t),t)){var n;if(!r.parent_message_uuid)throw Error("Parent UUID required");let t=r.parent_message_uuid;e.messageByUuid.set(r.uuid,r),e.parentByChildUuid.set(r.uuid,t);let a=null!==(n=e.childrenByParentUuid.get(t))&&void 0!==n?n:[];a.push(r.uuid),e.childrenByParentUuid.set(t,a),e.selectedChildByUuid.set(t,a.length-1)}return d(e,t[t.length-1].uuid)},_=(e,t)=>{let n=[],r=null!=t?t:s;for(;e.childrenByParentUuid.has(r);){let t=l(e.childrenByParentUuid,r);if(0===t.length)break;let a=l(e.selectedChildByUuid,r),u=l(e.messageByUuid,t[a]);n.push({...u,parent_message_uuid:r,nOptions:t.length,selectedOption:a}),r=u.uuid}return n};function p(e,t,n){var r;let a=l(e.parentByChildUuid,t.uuid),i=l(e.childrenByParentUuid,a),o=u()((null!==(r=t.selectedOption)&&void 0!==r?r:0)+n,0,i.length-1);e.selectedChildByUuid.set(a,o);let s=_(e,a);return d(e,s[s.length-1].uuid)}},1812:function(e,t,n){n.d(t,{I:function(){return o},T:function(){return i}});var r=n(27573),a=n(7653);let u=(0,a.createContext)(null),i=()=>{let e=(0,a.useContext)(u);return void 0===e?null:e},o=e=>{let{children:t,settings:n}=e;return(0,r.jsx)(u.Provider,{value:n,children:t})}},32737:function(e,t,n){n.d(t,{u:function(){return g}});var r=n(41596),a=n(27573),u=n(9788),i=n(85638),o=n(10607),s=n(68425);function c(){let e=(0,r._)(["\n  px-2\n  py-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-md\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return c=function(){return e},e}function l(){let e=(0,r._)(["\n  max-w-[337px]\n  z-tooltip\n  [*:disabled_&]:hidden\n"]);return l=function(){return e},e}function d(){let e=(0,r._)(["\n  p-1\n  text-xs\n  font-medium\n  font-sans\n  leading-tight\n  rounded-lg\n  shadow-md\n  text-white\n  bg-black/80\n  backdrop-blur\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return d=function(){return e},e}function f(){let e=(0,r._)(["\n  p-1\n  text-sm\n  font-normal\n  font-styrene\n  leading-tight\n  border-border-300\n  border-0.5\n  rounded-lg\n  shadow-diffused \n  shadow-[hsl(var(--always-black)/4%)]\n  text-text-100\n  bg-bg-100\n  break-words\n  z-tooltip\n  max-w-[13rem]\n  [*:disabled_&]:hidden\n"]);return f=function(){return e},e}function g(e){let{children:t,tooltipContent:n,contentStyle:r="default",side:u="top",sideOffset:s,align:c,className:l,delayDuration:d=200,...f}=e,g=v[r];return(0,a.jsx)(i.zt,{delayDuration:d,children:(0,a.jsxs)(i.fC,{...f,children:[(0,a.jsx)(i.xz,{asChild:!0,children:t}),(0,a.jsx)(i.h_,{children:(0,a.jsx)("span",{children:(0,a.jsx)(g,{className:(0,o.Z)(l,!n&&"hidden"),sideOffset:null!=s?s:5,side:u,align:c,children:n})})})]})})}let y=(0,u.q)(i.VY)(c()),h=(0,u.q)(i.VY)(l()),v={default:y,citation:e=>{let{children:t,...n}=e;return(0,a.jsx)(h,{...n,children:(0,a.jsx)(s.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},className:"p-1 text-sm font-normal font-styrene leading-tight text-text-200 bg-bg-100 break-words border-0.5 border-border-300/25 max-h-[300px] shadow-diffused shadow-[hsl(var(--always-black)/4%)] rounded-lg overflow-y-auto",children:t})})},inputMenu:(0,u.q)(i.VY)(d()),sampleImage:(0,u.q)(i.VY)(f())}},98731:function(e,t,n){n.d(t,{K:function(){return r}});let r=e=>{let t="";if(e.content)for(let n of e.content)"text"===n.type&&(t+=n.text);return t}},10228:function(e,t,n){var r,a,u,i;n.d(t,{Fg:function(){return r},co:function(){return a},hP:function(){return o},qC:function(){return s}}),(u=r||(r={})).GITHUB="github",u.GDRIVE="gdrive",u.OUTLINE="outlin",u.SALESFORCE="sfdc",u.GMAIL="gmail",u.GCAL="gcal",u.SLACK="slack",u.ASANA="asana";let o={github:"GitHub",gdrive:"Google Drive",outlin:"Outline",sfdc:"Salesforce",gmail:"Gmail",gcal:"Google Calendar",slack:"Slack",asana:"Asana"};(i=a||(a={})).CREATED="created",i.PENDING="pending",i.FAILED="failed",i.UPDATING="updating",i.UPDATE_FAILED="update_failed",i.READY="ready",i.UNAUTHENTICATED="unauthenticated",i.ACCESS_DENIED="access_denied",i.DISABLED="disabled";let s=["access_denied","failed","unauthenticated","update_failed"]},51432:function(e,t,n){n.d(t,{H:function(){return r}});let r=()=>void 0===crypto.randomUUID?"".concat(1e7,"-",1e3,"-",4e3,"-",8e3,"-",1e11).replace(/[018]/g,e=>{let t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):crypto.randomUUID()}}]);